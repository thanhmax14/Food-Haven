@using System.Text.Json
@model Repository.ViewModels.IndexUserViewModels

<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8" />
    <title>Nest - Multipurpose eCommerce HTML Template</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="" />
    <meta property="og:type" content="" />
    <meta property="og:url" content="" />
    <meta property="og:image" content="" />
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="~/assets/imgs/theme/favicon.svg" />
    <!-- Template CSS -->
    <link rel="stylesheet" href="~/assets/css/main.css?v=6.0" />

    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="chrome-extension://mooikfkahbdckldjjndioackbalphokd/~/assets/prompt.js"></script>
    @Html.Raw(" <link href='https://cdn.jsdelivr.net/npm/@flaticon/flaticon-uicons/css/all/all.css' rel='stylesheet'>");

      <link rel="stylesheet" href="~/assets/js/gridjs/theme/mermaid.min.css">
</head>

<body>
    <style>
        .gridjs-input {
            height: 42px !important;
        }

        .mr-2 {
            margin-right: 10px;
        }
    </style>

    @await Html.PartialAsync("_Header")
    <div class="mobile-header-active mobile-header-wrapper-style">
        <div class="mobile-header-wrapper-inner">
            <div class="mobile-header-top">
                <div class="mobile-header-logo">
                    <a href="index.html"><img src="~/assets/imgs/theme/logo.svg" alt="logo" /></a>
                </div>
                <div class="mobile-menu-close close-style-wrap close-style-position-inherit">
                    <button class="close-style search-close">
                        <i class="icon-top"></i>
                        <i class="icon-bottom"></i>
                    </button>
                </div>
            </div>
            <div class="mobile-header-content-area">
                <div class="mobile-search search-style-3 mobile-header-border">
                    <form action="#">
                        <input type="text" placeholder="Search for items…" />
                        <button type="submit"><i class="fi-rs-search"></i></button>
                    </form>
                </div>
                <div class="mobile-menu-wrap mobile-header-border">
                    <!-- mobile menu start -->
                    <nav>
                        <ul class="mobile-menu font-heading">
                            <li class="menu-item-has-children">
                                <a href="index.html">Home</a>
                                <ul class="dropdown">
                                    <li><a href="index.html">Home 1</a></li>
                                    <li><a href="index-2.html">Home 2</a></li>
                                    <li><a href="index-3.html">Home 3</a></li>
                                    <li><a href="index-4.html">Home 4</a></li>
                                    <li><a href="index-5.html">Home 5</a></li>
                                    <li><a href="index-6.html">Home 6</a></li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children">
                                <a href="shop-grid-right.html">shop</a>
                                <ul class="dropdown">
                                    <li><a href="shop-grid-right.html">Shop Grid – Right Sidebar</a></li>
                                    <li><a href="shop-grid-left.html">Shop Grid – Left Sidebar</a></li>
                                    <li><a href="shop-list-right.html">Shop List – Right Sidebar</a></li>
                                    <li><a href="shop-list-left.html">Shop List – Left Sidebar</a></li>
                                    <li><a href="shop-fullwidth.html">Shop - Wide</a></li>
                                    <li class="menu-item-has-children">
                                        <a href="#">Single Product</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Product – Right Sidebar</a></li>
                                            <li><a href="shop-product-left.html">Product – Left Sidebar</a></li>
                                            <li><a href="shop-product-full.html">Product – No sidebar</a></li>
                                            <li><a href="shop-product-vendor.html">Product – Vendor Infor</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="shop-filter.html">Shop – Filter</a></li>
                                    <li><a href="shop-wishlist.html">Shop – Wishlist</a></li>
                                    <li><a href="shop-cart.html">Shop – Cart</a></li>
                                    <li><a href="shop-checkout.html">Shop – Checkout</a></li>
                                    <li><a href="shop-compare.html">Shop – Compare</a></li>
                                    <li class="menu-item-has-children">
                                        <a href="#">Shop Invoice</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-invoice-1.html">Shop Invoice 1</a></li>
                                            <li><a href="shop-invoice-2.html">Shop Invoice 2</a></li>
                                            <li><a href="shop-invoice-3.html">Shop Invoice 3</a></li>
                                            <li><a href="shop-invoice-4.html">Shop Invoice 4</a></li>
                                            <li><a href="shop-invoice-5.html">Shop Invoice 5</a></li>
                                            <li><a href="shop-invoice-6.html">Shop Invoice 6</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children">
                                <a href="#">Vendors</a>
                                <ul class="dropdown">
                                    <li><a href="vendors-grid.html">Vendors Grid</a></li>
                                    <li><a href="vendors-list.html">Vendors List</a></li>
                                    <li><a href="vendor-details-1.html">Vendor Details 01</a></li>
                                    <li><a href="vendor-details-2.html">Vendor Details 02</a></li>
                                    <li><a href="vendor-dashboard.html">Vendor Dashboard</a></li>
                                    <li><a href="vendor-guide.html">Vendor Guide</a></li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children">
                                <a href="#">Mega menu</a>
                                <ul class="dropdown">
                                    <li class="menu-item-has-children">
                                        <a href="#">Women's Fashion</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Dresses</a></li>
                                            <li><a href="shop-product-right.html">Blouses & Shirts</a></li>
                                            <li><a href="shop-product-right.html">Hoodies & Sweatshirts</a></li>
                                            <li><a href="shop-product-right.html">Women's Sets</a></li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children">
                                        <a href="#">Men's Fashion</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Jackets</a></li>
                                            <li><a href="shop-product-right.html">Casual Faux Leather</a></li>
                                            <li><a href="shop-product-right.html">Genuine Leather</a></li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children">
                                        <a href="#">Technology</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Gaming Laptops</a></li>
                                            <li><a href="shop-product-right.html">Ultraslim Laptops</a></li>
                                            <li><a href="shop-product-right.html">Tablets</a></li>
                                            <li><a href="shop-product-right.html">Laptop Accessories</a></li>
                                            <li><a href="shop-product-right.html">Tablet Accessories</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children">
                                <a href="blog-category-fullwidth.html">Blog</a>
                                <ul class="dropdown">
                                    <li><a href="blog-category-grid.html">Blog Category Grid</a></li>
                                    <li><a href="blog-category-list.html">Blog Category List</a></li>
                                    <li><a href="blog-category-big.html">Blog Category Big</a></li>
                                    <li><a href="blog-category-fullwidth.html">Blog Category Wide</a></li>
                                    <li class="menu-item-has-children">
                                        <a href="#">Single Product Layout</a>
                                        <ul class="dropdown">
                                            <li><a href="blog-post-left.html">Left Sidebar</a></li>
                                            <li><a href="blog-post-right.html">Right Sidebar</a></li>
                                            <li><a href="blog-post-fullwidth.html">No Sidebar</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children">
                                <a href="#">Pages</a>
                                <ul class="dropdown">
                                    <li><a href="page-about.html">About Us</a></li>
                                    <li><a href="page-contact.html">Contact</a></li>
                                    <li><a href="page-account.html">My Account</a></li>
                                    <li><a href="page-login.html">Login</a></li>
                                    <li><a href="page-register.html">Register</a></li>
                                    <li><a href="page-forgot-password.html">Forgot password</a></li>
                                    <li><a href="page-reset-password.html">Reset password</a></li>
                                    <li><a href="page-purchase-guide.html">Purchase Guide</a></li>
                                    <li><a href="page-privacy-policy.html">Privacy Policy</a></li>
                                    <li><a href="page-terms.html">Terms of Service</a></li>
                                    <li><a href="page-404.html">404 Page</a></li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children">
                                <a href="#">Language</a>
                                <ul class="dropdown">
                                    <li><a href="#">English</a></li>
                                    <li><a href="#">French</a></li>
                                    <li><a href="#">German</a></li>
                                    <li><a href="#">Spanish</a></li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                    <!-- mobile menu end -->
                </div>
                <div class="mobile-header-info-wrap">
                    <div class="single-mobile-header-info">
                        <a href="page-contact.html"><i class="fi-rs-marker"></i> Our location </a>
                    </div>
                    <div class="single-mobile-header-info">
                        <a href="page-login.html"><i class="fi-rs-user"></i>Log In / Sign Up </a>
                    </div>
                    <div class="single-mobile-header-info">
                        <a href="#"><i class="fi-rs-headphones"></i>(+01) - 2345 - 6789 </a>
                    </div>
                </div>
                <div class="mobile-social-icon mb-50">
                    <h6 class="mb-15">Follow Us</h6>
                    <a href="#"><img src="~/assets/imgs/theme/icons/icon-facebook-white.svg" alt="" /></a>
                    <a href="#"><img src="~/assets/imgs/theme/icons/icon-twitter-white.svg" alt="" /></a>
                    <a href="#"><img src="~/assets/imgs/theme/icons/icon-instagram-white.svg" alt="" /></a>
                    <a href="#"><img src="~/assets/imgs/theme/icons/icon-pinterest-white.svg" alt="" /></a>
                    <a href="#"><img src="~/assets/imgs/theme/icons/icon-youtube-white.svg" alt="" /></a>
                </div>
                <div class="site-copyright">Copyright 2024 © Nest. All rights reserved. Powered by AliThemes.</div>
            </div>
        </div>
    </div>
    <!--End header-->
    <main class="main pages">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="index.html" rel="nofollow"><i class="fi-rs-home mr-5"></i>Home</a>
                    <span></span> Pages <span></span> My Account
                </div>
            </div>
        </div>
        <div class="page-content pt-150 pb-150">
            <div class="container">
                <div class="row">
                    <div class="col-lg-11 m-auto">
                        <div class="row">
                            <div class="col-md-2">
                                <div class="dashboard-menu">
                                    <ul class="nav flex-column" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab"
                                               href="#dashboard" role="tab" aria-controls="dashboard"
                                               aria-selected="false">
                                                <i class="fi-rs-settings-sliders mr-10"></i>Dashboard
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders"
                                               role="tab" aria-controls="orders" aria-selected="false">
                                                <i class="fi-rs-shopping-bag mr-10"></i>Orders
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="order-details-tab" data-bs-toggle="tab" href="#order-details" role="tab" aria-controls="order-details" aria-selected="false" style="display: none;">
                                                <i class="fi-rs-shopping-bag mr-10"></i>Order Details
                                            </a>
                                        </li>

                                        <li class="nav-item">
                                            <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab"
                                               href="#track-orders" role="tab" aria-controls="track-orders"
                                               aria-selected="false">
                                                <i class="fi-rs-shopping-cart-check mr-10"></i>Track Your Order
                                            </a>
                                        </li>
                                       
                                        @if (Model.userView.RequestSeller == "0" || Model.userView.RequestSeller == "1")
                                        {
                                            <li class="nav-item">
                                                <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address"
                                                   role="tab" aria-controls="address" aria-selected="true">
                                                    <i class="fi-rs-marker mr-10"></i>Register Seller
                                                </a>
                                            </li>
                                        } else
                                        {
                                            <li class="nav-item">
                                                <a class="nav-link" id="address-tab" target="_blank" asp-controller="Seller" asp-action="viewstore"
                                                   role="tab" aria-controls="address" aria-selected="true">
                                                    <i class="fi-rs-marker mr-10"></i>Management Seller
                                                </a>
                                            </li>
                                        }
                                        <li class="nav-item">
                                            <a class="nav-link" id="account-detail-tab" data-bs-toggle="tab"
                                               href="#account-detail" role="tab" aria-controls="account-detail"
                                               aria-selected="true"><i class="fi-rs-user mr-10"></i>Account details</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="wallet-tab" data-bs-toggle="tab" href="#wallet"
                                               role="tab" aria-controls="wallet" aria-selected="true">
                                                <i class="fi-rs-user mr-10"></i>Wallet
                                            </a>
                                        </li>
                                        @* <li class="nav-item"> 
                                            <a class="nav-link" id="Feedback-tab" data-bs-toggle="tab" href="#Feedback"
                                               role="tab" aria-controls="Feedback" aria-selected="false">
                                                <i class="fi-rs-shopping-bag mr-10"></i>Your Feedback
                                            </a>
                                        </li>*@
                                        <li class="nav-item">
                                            <a class="nav-link" href="page-login.html">
                                                <i class="fi-rs-sign-out mr-10"></i>Logout
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-10">
                                <div class="tab-content account dashboard-content pl-50">
                                    <div class="tab-pane fade active show" id="dashboard" role="tabpanel"
                                         aria-labelledby="dashboard-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="mb-0">Hello Rosie!</h3>
                                            </div>
                                            <div class="card-body">
                                                <p>
                                                    From your account dashboard. you can easily check &amp; view your <a href="#">recent orders</a>,<br />
                                                    manage your <a href="#">shipping and billing addresses</a> and <a href="#">edit your password and account details.</a>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade show active" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="mb-0">Your Orders</h3>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive" id="table-orders"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="tab-pane fade" id="order-details" role="tabpanel" aria-labelledby="order-details-tab" style="display: none;">
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="mb-0">Order Details</h3>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive" id="table-order-details"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <script>
     console.log("Hello");
let detailsGrid = null;

document.addEventListener("DOMContentLoaded", function () {
    const orderContainer = document.getElementById("table-orders");
    orderContainer.innerHTML = "";

    const orderData = @Html.Raw(JsonSerializer.Serialize(Model.OrderViewodels));

    new gridjs.Grid({
        columns: [
            { name: "Id", hidden: true },
            { name: "Email", width: "200px" },
            { name: "Name", width: "200px" },
            { 
                name: "Order Date", 
                width: "220px", 
                formatter: (cell) => {
                    const date = new Date(cell);
                    return date.toLocaleDateString("vi-VN", { 
                        day: "2-digit", 
                        month: "2-digit", 
                        year: "numeric" 
                    }) + " " + date.toLocaleTimeString("vi-VN", { 
                        hour: "2-digit", 
                        minute: "2-digit", 
                        second: "2-digit" 
                    });
                }
            },
            { name: "Payment Method", width: "200px" },
            { name: "Status", width: "150px" },
            { name: "Total", width: "150px" },
            { name: "Username", hidden: true },
            { name: "UserId", hidden: true },
            {
                name: "Actions",
                width: "150px",
                formatter: (_, row) => {
                    const orderId = row.cells[0].data;
                    const username = row.cells[7].data;
                    const userId = row.cells[8].data;
                    return gridjs.html(`<button class="btn btn-sm btn-primary view-details" data-id="${orderId}" data-username="${username}" data-userid="${userId}">Details</button>`);
                }
            }
        ],
        pagination: { enabled: true, limit: 5, summary: true },
        sort: true,
        search: true,
        data: orderData.map(o => [
            o.OrderId, o.Email, o.Name, o.OrderDate, o.PaymentMethod, o.Status, o.Total, o.Username, o.UserId
        ])
    }).render(orderContainer);

    document.addEventListener("click", function (e) {
        if (e.target.classList.contains("view-details")) {
            const orderId = e.target.getAttribute("data-id");
            const username = e.target.getAttribute("data-username");
            const userId = e.target.getAttribute("data-userid");
            loadOrderDetails(orderId, username, userId);
        } else if (e.target.classList.contains("feedback-btn")) {
            const productName = e.target.getAttribute("data-product");
            const orderId = e.target.getAttribute("data-order-id");
            const username = e.target.getAttribute("data-username");
            const userId = e.target.getAttribute("data-userid");
            const productId = e.target.getAttribute("data-productid"); // Lấy ProductId

            document.getElementById("id-field").value = userId;
            document.getElementById("product_id-field").value = productId; // Điền ProductId vào input ẩn
            document.getElementById("product_name-field").value = productName;
            document.getElementById("email_id-field").value = username;

            const stars = document.querySelectorAll("#star-rating .star");
            stars.forEach(star => star.classList.remove("selected"));
            document.getElementById("designation-field").value = "0";
        }
    });

    document.querySelectorAll('.nav-link[data-bs-toggle="tab"]').forEach(tab => {
        tab.addEventListener('shown.bs.tab', function (e) {
            const targetTab = e.target.getAttribute('href');
            if (targetTab !== '#order-details') {
                document.getElementById("order-details").style.display = "none";
            }
        });
    });

    const stars = document.querySelectorAll("#star-rating .star");
    stars.forEach(star => {
        star.addEventListener("click", function () {
            const rating = this.getAttribute("data-value");
            document.getElementById("designation-field").value = rating;

            stars.forEach(s => {
                if (s.getAttribute("data-value") <= rating) {
                    s.classList.add("selected");
                } else {
                    s.classList.remove("selected");
                }
            });
        });
    });

    document.querySelector("#showModal form").addEventListener("submit", function (e) {
        e.preventDefault();

        const userId = document.getElementById("id-field").value;
        const productId = document.getElementById("product_id-field").value; // Lấy ProductId từ input ẩn
        const userName = document.getElementById("email_id-field").value;
        const productName = document.getElementById("product_name-field").value;
        const reply = document.getElementById("company_name-field").value;
        const starRating = document.getElementById("designation-field").value;

        console.log("Reply value:", reply);
        if (!reply.trim()) {
            alert("Please enter your reply.");
            return;
        }

        const feedbackData = {
            UserId: userId,
            ProductId: productId, // Gửi ProductId
            UserName: userName,
            ProductName: productName,
            Cmt: reply,
            StarRating: starRating
        };

        console.log("Sending feedback data:", feedbackData);

        fetch("/Users/AddFeekback", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Accept": "application/json"
            },
            body: JSON.stringify(feedbackData)
        })
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    bootstrap.Modal.getInstance(document.getElementById("showModal")).hide();
                } else {
                    alert(data.message);
                }
            })
            .catch(error => {
                console.error("Fetch error:", error);
                alert("An error occurred while submitting feedback.");
            });
    });

    function loadOrderDetails(orderId, username, userId) {
        fetch(`/Users/GetOrderDetails?orderId=${orderId}&_=${Date.now()}`, {
            cache: 'no-store'
        })
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                return response.json();
            })
            .then(data => {
                console.log("Response data:", data);
                if (data.success) {
                    const detailsContainer = document.getElementById("table-order-details");
                    detailsContainer.innerHTML = "";
                    if (detailsGrid) {
                        detailsGrid.destroy();
                    }
                    detailsGrid = new gridjs.Grid({
                        columns: [
                            { name: "Product Name", width: "250px" },
                            { name: "Product Price", width: "150px" },
                            { name: "Total Price", width: "150px" },
                            { name: "Quantity", width: "100px" },
                            { name: "Status", width: "150px" },
                            {
                                name: "Actions",
                                width: "150px",
                                formatter: (_, row) => {
                                    const productName = row.cells[0].data;
                                    const productId = row.cells[5].data; // ProductId ở cột thứ 6
                                    return gridjs.html(`<button class="btn btn-sm btn-success feedback-btn" data-bs-toggle="modal" data-bs-target="#showModal" data-product="${productName}" data-order-id="${orderId}" data-username="${username}" data-userid="${userId}" data-productid="${productId}">Feedback</button>`);
                                }
                            }
                        ],
                        pagination: { enabled: true, limit: 5, summary: true },
                        search: true,
                        sort: true,
                        data: data.data.map(od => [
                            od.productName,
                            od.productPrice,
                            od.totalPrice,
                            od.quantity,
                            od.status,
                            od.productId // Thêm ProductId vào dữ liệu
                        ])
                    });
                    detailsGrid.render(detailsContainer);

                    const orderDetailsPane = document.getElementById("order-details");
                    orderDetailsPane.style.display = "block";
                    const orderDetailsTab = new bootstrap.Tab(document.getElementById("order-details-tab"));
                    orderDetailsTab.show();
                } else {
                    console.log("Success is false:", data.message);
                }
            })
            .catch(error => console.error("Fetch error:", error));
    }
});
                                    </script>

                                <div class="modal fade" id="showModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0">
            <div class="modal-header bg-info-subtle p-3">
                <h5 class="modal-title" id="exampleModalLabel">Enter Your Review</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="close-modal"></button>
            </div>
            <form class="tablelist-form" autocomplete="off">
                <div class="modal-body">
                    <input type="hidden" id="id-field" />
                    <input type="hidden" id="product_id-field" /> <!-- Lưu ProductId -->
                    <div class="row g-3">
                        <div class="col-lg-6">
                            <div>
                                <label for="email_id-field" class="form-label">User Name</label>
                                <input type="text" id="email_id-field" class="form-control" placeholder="User Name" required />
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div>
                                <label for="product_name-field" class="form-label">Product Name</label>
                                <input type="text" id="product_name-field" class="form-control" placeholder="Product Name" required />
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <div>
                                <label for="company_name-field" class="form-label">Your Reply</label>
                                <input type="text" id="company_name-field" class="form-control" placeholder="Your Reply" required />
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <div>
                                <label class="form-label">Star Rating</label>
                                <div class="star-rating" id="star-rating">
                                    <span class="star" data-value="1">&#9733;</span>
                                    <span class="star" data-value="2">&#9733;</span>
                                    <span class="star" data-value="3">&#9733;</span>
                                    <span class="star" data-value="4">&#9733;</span>
                                    <span class="star" data-value="5">&#9733;</span>
                                </div>
                                <input type="hidden" id="designation-field" name="starRating" value="0" required /> <!-- Lưu giá trị rating -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="hstack gap-2 justify-content-end">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-success" id="add-btn">Add Review</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<style>
.star-rating {
    font-size: 24px;
    color: #ddd; /* Màu mặc định của sao (chưa chọn) */
    cursor: pointer;
    display: inline-flex;
    gap: 5px;
}

.star-rating .star:hover,
.star-rating .star:hover ~ .star,
.star-rating .star.selected {
    color: #f5c518; /* Màu vàng khi hover hoặc được chọn */
}

.star-rating .star.selected {
    color: #f5c518; /* Màu vàng cho sao đã chọn */
}
</style>


                                    <div class="tab-pane fade" id="track-orders" role="tabpanel"
                                         aria-labelledby="track-orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="mb-0">Orders tracking</h3>
                                            </div>
                                            <div class="card-body contact-from-area">
                                                <p>
                                                    To track your order please enter your OrderID in the box below and
                                                    press "Track" button. This was given to you on your receipt and in
                                                    the confirmation email you should have received.
                                                </p>
                                                <div class="row">
                                                    <div class="col-lg-8">
                                                        <form class="contact-form-style mt-30 mb-50" action="#"
                                                              method="post">
                                                            <div class="input-style mb-20">
                                                                <label>Order ID</label>
                                                                <input name="order-id"
                                                                       placeholder="Found in your order confirmation email"
                                                                       type="text" />
                                                            </div>
                                                            <div class="input-style mb-20">
                                                                <label>Billing email</label>
                                                                <input name="billing-email"
                                                                       placeholder="Email you used during checkout"
                                                                       type="email" />
                                                            </div>
                                                            <button class="submit submit-auto-width"
                                                                    type="submit">
                                                                Track
                                                            </button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="address" role="tabpanel"
                                         aria-labelledby="address-tab">
                                        <div class="row justify-content-center">
                                            <div class="col-lg-8">
                                                @if (Model.userView.RequestSeller == "0") // Nếu chưa đăng ký seller
                                                {
                                                    <div class="card shadow-sm border-0">
                                                        <div class="card-header bg-warning text-dark text-center">
                                                            <h4 class="mb-0">Become a Seller</h4>
                                                        </div>
                                                        <div class="card-body text-center">
                                                            <p class="text-muted">
                                                                Unlock new opportunities by selling your products on our platform.
                                                            </p>
                                                            <button class="btn btn-success mt-2" id="btnRegisterSeller">Register as Seller</button>
                                                        </div>
                                                    </div>
                                                }
                                                else if (Model.userView.RequestSeller == "1")
                                                {
                                                       <div class="alert alert-info mt-3" id="approvalMessage">
                                                <h5>Announcement!</h5>
                                                <p>Your request has been submitted. Please wait for admin approval.</p>
                                                </div> 
                                                }
                                                else if (Model.userView.RequestSeller == "3") // Nếu đã đăng ký và chờ duyệt
                                                 {
                                                   @*   <div class="alert alert-info mt-3" id="approvalMessage">
                                                         <h5>Announcement!</h5>
                                                         <p>Your request has been submitted. Please wait for admin approval.</p>
                                                     </div> *@
                                                    <div class="alert alert-danger mt-3" id="rejectedMessage">
                                                        <h5>Rejected!</h5>
                                                        <p>Your request to become a seller has been denied. Please contact support for more information.</p>
                                                    </div>
                                                 }
                                              @*   else // Nếu bị từ chối hoặc giá trị khác
                                                {
                                                    <div class="alert alert-danger mt-3" id="rejectedMessage">
                                                        <h5>Rejected!</h5>
                                                        <p>Your request to become a seller has been denied. Please contact support for more information.</p>
                                                    </div>
                                                } *@
                                            </div>

                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="account-detail" role="tabpanel"
                                         aria-labelledby="account-detail-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5>Account Details</h5>
                                            </div>
                                            <div class="card-body">
                                                <p>
                                                    Already have an account? <a href="page-login.html">
                                                        Log in
                                                        instead!
                                                    </a>
                                                </p>
                                                <form id="updateProfileForm">
                                                    <div class="row">
                                                        <div class="form-group col-md-6">
                                                            <label>UserName <span class="required">*</span></label>
                                                            <input required class="form-control" id="UserName" name="UserName" type="text" value="@Model.userView.UserName" />

                                                        </div>
                                                        <div class="form-group col-md-6">
                                                            <label>Email <span class="required">*</span></label>
                                                            <input required class="form-control" id="Email" name="Email" type="text" value="@Model.userView.Email" />
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>Phone Number <span class="required">*</span></label>
                                                            <input  class="form-control" id="PhoneNumber" name="PhoneNumber" type="text" value="@Model.userView.PhoneNumber" />

                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>Address <span class="required">*</span></label>
                                                            <input  class="form-control" id="Address" name="Address" type="text" value="@Model.userView.Address" />

                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>Birthday <span class="required">*</span></label>
                                                            <input  class="form-control" id="Birthday" name="Birthday" type="date" value="@(Model.userView.Birthday != null ? Model.userView.Birthday.Value.ToString("yyyy-MM-dd") : "")" />


                                                        </div>
                                                        @* <div class="form-group col-md-12">
                                                        <label>
                                                        Current Password <span class="required">*</span>
                                                        </label>
                                                        <input required="" class="form-control" name="password"
                                                        type="password" />
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                        <label>New Password <span class="required">*</span></label>
                                                        <input required="" class="form-control" name="npassword"
                                                        type="password" />
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                        <label>
                                                        Confirm Password <span class="required">*</span>
                                                        </label>
                                                        <input required="" class="form-control" name="cpassword"
                                                        type="password" />
                                                        </div> *@
                                                        <div class="col-md-12">
                                                            <button type="submit"
                                                                    class="btn btn-fill-out submit font-weight-bold"
                                                                    name="submit" value="Submit">
                                                                Save Change
                                                            </button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="tab-pane fade" id="wallet" role="tabpanel" aria-labelledby="wallet-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="mb-0">Your Balance : <span id="balance-display">@Model.BalanceUser vnd</span></h3>
                                            </div>
                                            <div class="container mt-4">

                                                <div class="row mb-4">
                                                    <div class="col-md-12">
                                                        <button class="btn btn-success mr-2" id="depositBtn">
                                                            Nạp
                                                            Tiền
                                                        </button>
                                                        <button class="btn btn-danger" id="withdrawBtn">
                                                            Rút
                                                            Tiền
                                                        </button>
                                                    </div>
                                                </div>

                                                <!-- Forms container -->
                                                <div class="row">
                                                    @Html.AntiForgeryToken()
                                                    <div class="col-md-6" id="depositForm" style="display: none;">
                                                        <div class="card shadow-sm">
                                                            <div class="card-header">
                                                                <h5 class="mb-0">Nạp Tiền</h5>
                                                            </div>
                                                            <div class="card-body">
                                                                <label class="form-label">
                                                                    <p>Số tiền nạp</p>
                                                                </label>
                                                                <input type="number" id="numOrder" class="form-control mb-3">
                                                                <label class="form-label">
                                                                    <p>Hình thức thanh toán</p>
                                                                </label>
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="radio"
                                                                           name="paymentType" checked>
                                                                    <label class="form-check-label">
                                                                        <p>Online payment</p>
                                                                    </label>
                                                                </div>
                                                                <button id="btnDeposit" class="btn btn-success mt-3 w-100">
                                                                    Nạp
                                                                    Tiền
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Rút tiền form -->
                                                    <div class="col-md-6" id="withdrawForm" style="display: none;">
                                                        <div class="card shadow-sm">
                                                            <div class="card-header">
                                                                <h5 class="mb-0">
                                                                    Rút Tiền
                                                                </h5>
                                                            </div>
                                                            <div class="card-body">
                                                                <label class="form-label">
                                                                    <p>Số tiền rút</p>
                                                                </label>
                                                                <input type="text" class="form-control mb-3" id="numOrderVut">
                                                                <label class="form-label">
                                                                    <p>Phương thức rút</p>
                                                                </label>
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="radio"
                                                                           name="withdrawType" checked>
                                                                    <label class="form-check-label">
                                                                        <p>
                                                                            Chuyển khoản ngân
                                                                            hàng
                                                                        </p>
                                                                    </label>
                                                                </div>
                                                                <label class="form-label">
                                                                    <p>Ngân Hàng</p>
                                                                </label>

                                                                <div class="custom_select">
                                                                    <select class="form-control select-active w-100" id="code">
                                                                        <option value="">United Kingdom</option>
                                                                        <option value="TT">Trinidad and Tobago</option>
                                                                        <option value="TN">Tunisia</option>
                                                                        <option value="TR">Turkey</option>
                                                                        <option value="TM">Turkmenistan</option>
                                                                        <option value="TC">
                                                                            Turks and Caicos Islands
                                                                        </option>
                                                                        <option value="TV">Tuvalu</option>
                                                                        <option value="UG">Uganda</option>
                                                                        <option value="UA">Ukraine</option>
                                                                        <option value="AE">United Arab Emirates</option>
                                                                        <option value="GB">United Kingdom (UK)</option>
                                                                        <option value="US">USA (US)</option>
                                                                        <option value="UY">Uruguay</option>
                                                                        <option value="UZ">Uzbekistan</option>
                                                                        <option value="VU">Vanuatu</option>
                                                                        <option value="VA">Vatican</option>
                                                                        <option value="VE">Venezuela</option>
                                                                        <option value="VN">Vietnam</option>
                                                                        <option value="WF">Wallis and Futuna</option>
                                                                        <option value="EH">Western Sahara</option>
                                                                        <option value="WS">Western Samoa</option>
                                                                        <option value="YE">Yemen</option>
                                                                        <option value="ZM">Zambia</option>
                                                                        <option value="ZW">Zimbabwe</option>
                                                                    </select>
                                                                </div>
                                                                <label class="form-label mt-3">
                                                                    <p>
                                                                        Tên tài khoản
                                                                        nhận
                                                                    </p>
                                                                </label>
                                                                <input type="text" class="form-control" id="nameAcc">
                                                                <label class="form-label mt-3">
                                                                    <p>Số tài khoản</p>
                                                                </label>
                                                                <input type="text" class="form-control" id="umaccou">
                                                                <button id="btnWithdraw" class="btn btn-danger mt-3 w-100">
                                                                    Rút
                                                                    Tiền
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <script>
                                                        document.addEventListener("DOMContentLoaded", function () {
                                                            const bankSelect = document.querySelector(".custom_select select");

                                                            async function fetchBanks() {
                                                                try {
                                                                    const response = await fetch("https://api.vietqr.io/v2/banks");
                                                                    const result = await response.json();

                                                                    if (result.code === "00" && result.data.length > 0) {
                                                                        bankSelect.innerHTML = ""; 

                                                                        result.data.forEach(bank => {
                                                                            const option = document.createElement("option");
                                                                            option.value = bank.code;  
                                                                            option.textContent = `${bank.name} (${bank.shortName})`;
                                                                            bankSelect.appendChild(option);
                                                                        });
                                                                    }
                                                                } catch (error) {
                                                                    console.error("Lỗi khi lấy danh sách ngân hàng:", error);
                                                                }
                                                            }

                                                            fetchBanks();
                                                        });
                                                    </script>
                                                </div>

                                                <!-- Transactions List -->
                                                <div class="card mt-4 w-100">
                                                    <div class="card-header d-flex justify-content-between align-items-center">
                                                        <h5>Transactions List</h5>
                                                    </div>
                                                    <div class="card-body w-100" id="Exampletable">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <script>
                                            const depositBtn = document.getElementById('depositBtn');
                                            const withdrawBtn = document.getElementById('withdrawBtn');
                                            const depositForm = document.getElementById('depositForm');
                                            const withdrawForm = document.getElementById('withdrawForm');
                                            const selectElement = withdrawForm.querySelector('select');

                                            // Function to hide both forms
                                            function hideForms() {
                                                depositForm.style.display = 'none';
                                                withdrawForm.style.display = 'none';
                                            }

                                            // Show deposit form
                                            depositBtn.addEventListener('click', function (e) {
                                                e.stopPropagation();
                                                if (depositForm.style.display === 'block') {
                                                    depositForm.style.display = 'none';
                                                } else {
                                                    hideForms();
                                                    depositForm.style.display = 'block';
                                                }
                                            });

                                            // Show withdraw form
                                            withdrawBtn.addEventListener('click', function (e) {
                                                e.stopPropagation();
                                                if (withdrawForm.style.display === 'block') {
                                                    withdrawForm.style.display = 'none';
                                                } else {
                                                    hideForms();
                                                    withdrawForm.style.display = 'block';
                                                }
                                            });

                                            document.addEventListener('click', function (e) {
                                                const isClickInsideSelect = selectElement && (selectElement.contains(e.target) || e.target.tagName === 'OPTION');
                                                const isClickInsideInput = e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA';

                                                if (!depositBtn.contains(e.target) &&
                                                    !withdrawBtn.contains(e.target) &&
                                                    !depositForm.contains(e.target) &&
                                                    !withdrawForm.contains(e.target) &&
                                                    !isClickInsideSelect &&
                                                    !isClickInsideInput) {
                                                    hideForms();
                                                }
                                            });


                                            // Prevent form clicks from closing the form
                                            depositForm.addEventListener('click', function (e) {
                                                e.stopPropagation();
                                            });

                                            withdrawForm.addEventListener('click', function (e) {
                                                e.stopPropagation();
                                            });

                                            // Handle select element specifically
                                            if (selectElement) {
                                                selectElement.addEventListener('click', function (e) {
                                                    e.stopPropagation();
                                                });

                                                selectElement.addEventListener('focus', function (e) {
                                                    e.stopPropagation();
                                                });

                                                selectElement.addEventListener('change', function (e) {
                                                    e.stopPropagation();
                                                });

                                                // Handle key events for search/filter in select
                                                selectElement.addEventListener('keydown', function (e) {
                                                    e.stopPropagation();
                                                });
                                            }

                                            // Keep form visible when interacting with inputs
                                            const inputs = document.querySelectorAll('#depositForm input, #withdrawForm input');
                                            inputs.forEach(input => {
                                                input.addEventListener('click', function (e) {
                                                    e.stopPropagation();
                                                });
                                                input.addEventListener('focus', function (e) {
                                                    e.stopPropagation();
                                                });
                                                input.addEventListener('keydown', function (e) {
                                                    e.stopPropagation();
                                                });
                                            });
                                        </script>

                                        <style>
                                            .mr-2 {
                                                margin-right: 10px;
                                            }

                                            .custom_select .select2-container--default .select2-selection--single {
                                                width: 484.8px;
                                            }

                                            .custom_select .select2-container {
                                                max-width: 484.8px;
                                            }
                                        </style>
                                    </div>

                                    @* ///FEEDBACK *@
                                    @* <div class="tab-pane fade" id="Feedback" role="tabpanel" aria-labelledby="Feedback-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="mb-0">Your Feedback</h3>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive" id="table-feedback">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <script>
                                        document.addEventListener("DOMContentLoaded", function () {
                                            const container = document.getElementById("table-feedback");*@
                                            @* var list = @Html.Raw(JsonSerializer.Serialize(Model.Reivew)); *@


                                    @* // Hàm khởi tạo bảng
                                            function initializeGrid(data) {
                                                if (!container.dataset.gridInitialized) {
                                                    container.innerHTML = "";
                                                    gridInstance = new gridjs.Grid({
                                                        columns: [
                                                            { name: "ID", hidden: true },
                                                            { name: "Product Name" },
                                                            { name: "Comment" },
                                                            { name: "Comment Date" },
                                                            { name: "Rating" },
                                                            { name: "Reply" }
                                                        ],
                                                        pagination: {
                                                            enabled: true,
                                                            limit: 5,
                                                            summary: true
                                                        },
                                                        sort: true,
                                                        search: true,
                                                        data: data.map(u => [
                                                            u.ID,
                                                            u.ProductName,
                                                            u.Cmt,
                                                            new Date(u.Datecmt).toLocaleDateString(), // Sửa 'review.Datecmt' thành 'u.Datecmt'
                                                            u.Rating,
                                                            u.Relay // Thêm Reply vào dữ liệu
                                                        ])
                                                    }).render(container);

                                                    container.dataset.gridInitialized = "true"; // Đánh dấu đã khởi tạo grid
                                                }
                                            }

                                            initializeGrid(list); // Gọi hàm khởi tạo bảng với dữ liệu
                                        });
                                    </script>*@

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
  
    
    <footer class="main">
        <section class="newsletter mb-15">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="position-relative newsletter-inner">
                            <div class="newsletter-content">
                                <h2 class="mb-20">
                                    Stay home & get your daily <br />
                                    needs from our shop
                                </h2>
                                <p class="mb-45">
                                    Start You'r Daily Shopping with <span class="text-brand">
                                        Nest
                                        Mart
                                    </span>
                                </p>
                                <form class="form-subcriber d-flex">
                                    <input type="email" placeholder="Your emaill address" />
                                    <button class="btn" type="submit">Subscribe</button>
                                </form>
                            </div>
                            <img src="~/assets/imgs/banner/banner-13.png" alt="newsletter" />
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="featured section-padding">
            <div class="container">
                <div class="row">
                    <div class="col-lg-1-5 col-md-4 col-12 col-sm-6 mb-md-4 mb-xl-0">
                        <div class="banner-left-icon d-flex align-items-center wow fadeIn animated">
                            <div class="banner-icon">
                                <img src="~/assets/imgs/theme/icons/icon-1.svg" alt="" />
                            </div>
                            <div class="banner-text">
                                <h3 class="icon-box-title">Best prices & offers</h3>
                                <p>Orders $50 or more</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-1-5 col-md-4 col-12 col-sm-6">
                        <div class="banner-left-icon d-flex align-items-center wow fadeIn animated">
                            <div class="banner-icon">
                                <img src="~/assets/imgs/theme/icons/icon-2.svg" alt="" />
                            </div>
                            <div class="banner-text">
                                <h3 class="icon-box-title">Free delivery</h3>
                                <p>24/7 amazing services</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-1-5 col-md-4 col-12 col-sm-6">
                        <div class="banner-left-icon d-flex align-items-center wow fadeIn animated">
                            <div class="banner-icon">
                                <img src="~/assets/imgs/theme/icons/icon-3.svg" alt="" />
                            </div>
                            <div class="banner-text">
                                <h3 class="icon-box-title">Great daily deal</h3>
                                <p>When you sign up</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-1-5 col-md-4 col-12 col-sm-6">
                        <div class="banner-left-icon d-flex align-items-center wow fadeIn animated">
                            <div class="banner-icon">
                                <img src="~/assets/imgs/theme/icons/icon-4.svg" alt="" />
                            </div>
                            <div class="banner-text">
                                <h3 class="icon-box-title">Wide assortment</h3>
                                <p>Mega Discounts</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-1-5 col-md-4 col-12 col-sm-6">
                        <div class="banner-left-icon d-flex align-items-center wow fadeIn animated">
                            <div class="banner-icon">
                                <img src="~/assets/imgs/theme/icons/icon-5.svg" alt="" />
                            </div>
                            <div class="banner-text">
                                <h3 class="icon-box-title">Easy returns</h3>
                                <p>Within 30 days</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-1-5 col-md-4 col-12 col-sm-6 d-xl-none">
                        <div class="banner-left-icon d-flex align-items-center wow fadeIn animated">
                            <div class="banner-icon">
                                <img src="~/assets/imgs/theme/icons/icon-6.svg" alt="" />
                            </div>
                            <div class="banner-text">
                                <h3 class="icon-box-title">Safe delivery</h3>
                                <p>Within 30 days</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="section-padding footer-mid">
            <div class="container pt-15 pb-20">
                <div class="row">
                    <div class="col">
                        <div class="widget-about font-md mb-md-3 mb-lg-3 mb-xl-0">
                            <div class="logo mb-30">
                                <a href="index.html" class="mb-15">
                                    <img src="~/assets/imgs/theme/logo.svg"
                                         alt="logo" />
                                </a>
                                <p class="font-lg text-heading">Awesome grocery store website template</p>
                            </div>
                            <ul class="contact-infor">
                                <li>
                                    <img src="~/assets/imgs/theme/icons/icon-location.svg" alt="" /><strong>
                                        Address:
                                    </strong> <span>5171 W Campbell Ave undefined Kent, Utah 53127 United States</span>
                                </li>
                                <li>
                                    <img src="~/assets/imgs/theme/icons/icon-contact.svg" alt="" /><strong>
                                        Call
                                        Us:
                                    </strong><span>(+91) - 540-025-124553</span>
                                </li>
                                <li>
                                    <img src="~/assets/imgs/theme/icons/icon-email-2.svg"
                                         alt="" /><strong>Email:</strong><span>sale@Nest.com</span>
                                </li>
                                <li>
                                    <img src="~/assets/imgs/theme/icons/icon-clock.svg"
                                         alt="" /><strong>Hours:</strong><span>10:00 - 18:00, Mon - Sat</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="footer-link-widget col">
                        <h4 class="widget-title">Company</h4>
                        <ul class="footer-list mb-sm-5 mb-md-0">
                            <li><a href="#">About Us</a></li>
                            <li><a href="#">Delivery Information</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Terms &amp; Conditions</a></li>
                            <li><a href="#">Contact Us</a></li>
                            <li><a href="#">Support Center</a></li>
                            <li><a href="#">Careers</a></li>
                        </ul>
                    </div>
                    <div class="footer-link-widget col">
                        <h4 class="widget-title">Account</h4>
                        <ul class="footer-list mb-sm-5 mb-md-0">
                            <li><a href="#">Sign In</a></li>
                            <li><a href="#">View Cart</a></li>
                            <li><a href="#">My Wishlist</a></li>
                            <li><a href="#">Track My Order</a></li>
                            <li><a href="#">Help Ticket</a></li>
                            <li><a href="#">Shipping Details</a></li>
                            <li><a href="#">Compare products</a></li>
                        </ul>
                    </div>
                    <div class="footer-link-widget col">
                        <h4 class="widget-title">Corporate</h4>
                        <ul class="footer-list mb-sm-5 mb-md-0">
                            <li><a href="#">Become a Vendor</a></li>
                            <li><a href="#">Affiliate Program</a></li>
                            <li><a href="#">Farm Business</a></li>
                            <li><a href="#">Farm Careers</a></li>
                            <li><a href="#">Our Suppliers</a></li>
                            <li><a href="#">Accessibility</a></li>
                            <li><a href="#">Promotions</a></li>
                        </ul>
                    </div>
                    <div class="footer-link-widget col">
                        <h4 class="widget-title">Popular</h4>
                        <ul class="footer-list mb-sm-5 mb-md-0">
                            <li><a href="#">Milk & Flavoured Milk</a></li>
                            <li><a href="#">Butter and Margarine</a></li>
                            <li><a href="#">Eggs Substitutes</a></li>
                            <li><a href="#">Marmalades</a></li>
                            <li><a href="#">Sour Cream and Dips</a></li>
                            <li><a href="#">Tea & Kombucha</a></li>
                            <li><a href="#">Cheese</a></li>
                        </ul>
                    </div>
                    <div class="footer-link-widget widget-install-app col">
                        <h4 class="widget-title">Install App</h4>
                        <p class="wow fadeIn animated">From App Store or Google Play</p>
                        <div class="download-app">
                            <a href="#" class="hover-up mb-sm-2 mb-lg-0">
                                <img class="active"
                                     src="~/assets/imgs/theme/app-store.jpg" alt="" />
                            </a>
                            <a href="#" class="hover-up mb-sm-2">
                                <img src="~/assets/imgs/theme/google-play.jpg"
                                     alt="" />
                            </a>
                        </div>
                        <p class="mb-20">Secured Payment Gateways</p>
                        <img class="wow fadeIn animated" src="~/assets/imgs/theme/payment-method.png" alt="" />
                    </div>
                </div>
            </div>
        </section>
        <div class="container pb-30">
            <div class="row align-items-center">
                <div class="col-12 mb-30">
                    <div class="footer-bottom"></div>
                </div>
                <div class="col-xl-4 col-lg-6 col-md-6">
                    <p class="font-sm mb-0">
                        &copy; 2024, <strong class="text-brand">Nest</strong> - HTML Ecommerce
                        Template <br />All rights reserved
                    </p>
                </div>
                <div class="col-xl-4 col-lg-6 text-center d-none d-xl-block">
                    <div class="hotline d-lg-inline-flex mr-30">
                        <img src="~/assets/imgs/theme/icons/phone-call.svg" alt="hotline" />
                        <p>1900 - 6666<span>Working 8:00 - 22:00</span></p>
                    </div>
                    <div class="hotline d-lg-inline-flex">
                        <img src="~/assets/imgs/theme/icons/phone-call.svg" alt="hotline" />
                        <p>1900 - 8888<span>24/7 Support Center</span></p>
                    </div>
                </div>
                <div class="col-xl-4 col-lg-6 col-md-6 text-end d-none d-md-block">
                    <div class="mobile-social-icon">
                        <h6>Follow Us</h6>
                        <a href="#"><img src="~/assets/imgs/theme/icons/icon-facebook-white.svg" alt="" /></a>
                        <a href="#"><img src="~/assets/imgs/theme/icons/icon-twitter-white.svg" alt="" /></a>
                        <a href="#"><img src="~/assets/imgs/theme/icons/icon-instagram-white.svg" alt="" /></a>
                        <a href="#"><img src="~/assets/imgs/theme/icons/icon-pinterest-white.svg" alt="" /></a>
                        <a href="#"><img src="~/assets/imgs/theme/icons/icon-youtube-white.svg" alt="" /></a>
                    </div>
                    <p class="font-sm">Up to 15% discount on your first subscribe</p>
                </div>
            </div>
        </div>
    </footer>
    <!-- Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="text-center">
                    <img src="~/assets/imgs/theme/loading.gif" alt="" />
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#updateProfileForm").submit(function (event) {
                event.preventDefault();

                var birthdayValue = $("#Birthday").val();
               var formData = {
    userView: {
        UserName: $("#UserName").val(),
        Email: $("#Email").val(),
        PhoneNumber: $("#PhoneNumber").val(),
        Address: $("#Address").val(),
        Birthday: birthdayValue ? birthdayValue : null,
    }
};

                $.ajax({
                    url: "/Users/UpdateProfile",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(formData),
                    beforeSend: function () {
                        Swal.fire({
                            title: "Đang cập nhật...",
                            text: "Vui lòng chờ...",
                            icon: "info",
                            showConfirmButton: false,
                            allowOutsideClick: false
                        });
                    },
                    success: function (response) {
                        if (response.success) {
                            Swal.fire({
                                title: "Thành công!",
                                text: "Cập nhật thông tin thành công!",
                                icon: "success",
                                confirmButtonText: "OK"
                            }).then(() => {
                                $("#account-detail").load(location.href + " #account-detail > *");
                            });
                        } else {
                            Swal.fire("Lỗi!", response.message || "Cập nhật thất bại!", "error");
                        }
                    },
                    error: function (xhr) {
                        let errorMessage = "Không thể kết nối với máy chủ.";
                        if (xhr.responseJSON && xhr.responseJSON.message) {
                            errorMessage = xhr.responseJSON.message;
                        }
                        Swal.fire("Lỗi!", errorMessage, "error");
                    }
                });
            });
        });

    </script>
    <script>
        $(document).ready(function () {
            $("#btnRegisterSeller").click(function (e) {
                e.preventDefault(); // Ngăn reload trang

                $.ajax({
                    url: "/Users/RegisterSeller", // Endpoint xử lý
                    type: "POST",
                    contentType: "application/json",
                    success: function (response) {
                        if (response.success) {
                            Swal.fire({
                                icon: "success",
                                title: "Success",
                                text: "Your seller registration request has been sent successfully!",
                                confirmButtonText: "OK"
                            }).then(() => {
                                // Cập nhật #address khi đăng ký thành công
                                $("#address").load(location.href + " #address > *");
                            });
                        } else {
                            Swal.fire({
                                icon: "error",
                                title: "Error",
                                text: response.message,
                                confirmButtonText: "OK"
                            }).then(() => {
                                // Nếu lỗi do thiếu thông tin => Cập nhật lại #account-detail
                                if (response.message.includes("Please update all required information")) {
                                    $('#account-detail-tab').tab('show'); // Nếu bạn dùng Bootstrap tabs
                                }
                            });
                        }
                    },
                    error: function () {
                        Swal.fire({
                            icon: "error",
                            title: "Error",
                            text: "An error occurred! Please try again.",
                            confirmButtonText: "OK"
                        });
                    }
                });
            });
        });



    </script>



    <!-- Vendor JS-->
    <script src="~/assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="~/assets/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="~/assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
    <script src="~/assets/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="~/assets/js/plugins/slick.js"></script>
    <script src="~/assets/js/plugins/jquery.syotimer.min.js"></script>
    <script src="~/assets/js/plugins/wow.js"></script>
    <script src="~/assets/js/plugins/perfect-scrollbar.js"></script>
    <script src="~/assets/js/plugins/magnific-popup.js"></script>
    <script src="~/assets/js/plugins/select2.min.js"></script>
    <script src="~/assets/js/plugins/waypoints.js"></script>
    <script src="~/assets/js/plugins/counterup.js"></script>
    <script src="~/assets/js/plugins/jquery.countdown.min.js"></script>
    <script src="~/assets/js/plugins/images-loaded.js"></script>
    <script src="~/assets/js/plugins/isotope.js"></script>
    <script src="~/assets/js/plugins/scrollup.js"></script>
    <script src="~/assets/js/plugins/jquery.vticker-min.js"></script>
    <script src="~/assets/js/plugins/jquery.theia.sticky.js"></script>
    <script src="~/assets/js/plugins/jquery.elevatezoom.js"></script>
    <!-- Template  JS -->
    <script src="~/assets/js/main.js?v=6.0"></script>
    <script src="~/assets/js/shop.js?v=6.0"></script>
        <script src="~/assets/js/gridjs/gridjs.umd.js"></script>
</body>

</html>
@* <script>
    document.addEventListener("DOMContentLoaded", function () {
        const container = document.getElementById("Exampletable");
        var list = @Html.Raw(JsonSerializer.Serialize(Model.Balance));

        container.innerHTML = "";

        new gridjs.Grid({
            columns: [
                { name: "NO.", width: "90px" , formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                { name: "Before", width: "110px", formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                {
                    name: "Before",
                    width: "110px",
                    formatter: (e) => {
                        const color = e < 0 ? "red" : "green";
                        return gridjs.html(`<p style="color:${color}">${e}</p>`)
                    }
                },
                { name: "After", width: "110px", formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                { name: "Type", width: "100px", formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                {
                    name: "Status",
                    width: "130px",
                    formatter: (e) => {
                        let color = "#C3A73A";

                        if (e.toLowerCase() === "done") {
                            color = "green";
                        } else if (e.toLowerCase() === "cancel") {
                            color = "#C10103";
                        }

                        return gridjs.html(`<p style="color:${color}; font-weight:bold;">${e}</p>`);
                    }
                },

                {
                    name: "Type",
                    width: "100px",
                    formatter: (e) => {
                        const date = new Date(e);
                        const formatted = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}:${date.getSeconds().toString().padStart(2, '0')}`;
                        return gridjs.html(`<p>${formatted}</p>`);
                    }
                },
                {
                    name: "Invoice",
                    width: "150px",
                    formatter: (e) => gridjs.html(`<a href="${e}" target="_blank" class="text-reset text-decoration-underline">Details</a>`)

                }
            ],
            pagination: {
                enabled: true,
                limit: 5,
                summary: true
            },
            pageSize: [5, 10, 20, 50],
            sort: true,
            search: true,
            data: list.map(u => [
                u.No,
                u.Before,
                u.Change,
                u.After,
                u.Types,
                u.Status,
                u.Date,
                u.Invoice
            ])
        }).render(document.getElementById("Exampletable"));
    });

</script>
 *@

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const container = document.getElementById("Exampletable");
        var list = @Html.Raw(JsonSerializer.Serialize(Model.Balance));
        let gridInstance = null;
        let isInteracting = false; // Biến để theo dõi trạng thái tương tác

        // Hàm khởi tạo bảng
        function initializeGrid(data) {
            if (!container.dataset.gridInitialized) {
                container.innerHTML = "";
                gridInstance = new gridjs.Grid({
                    columns: [
                        { name: "NO.", width: "90px", formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                        { name: "Before", width: "110px", formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                        {
                            name: "Change", // Đổi tên để tránh trùng "Before"
                            width: "110px",
                            formatter: (e) => {
                                const color = e < 0 ? "red" : "green";
                                return gridjs.html(`<p style="color:${color}">${e}</p>`);
                            }
                        },
                        { name: "After", width: "110px", formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                        { name: "Type", width: "110px", formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                        {
                            name: "Status",
                            width: "130px",
                            formatter: (e) => {
                                let color = "#C3A73A";
                                const status = e ? e.toLowerCase() : ""; 

                                if (status === "paid" || status === "success") {
                                    color = "green";
                                } else if (status === "cancelled") {
                                    color = "#C10103";
                                }

                                return gridjs.html(`<p style="color:${color}; font-weight:bold;">${e || "N/A"}</p>`);
                            }

                        },
                        {
                            name: "Date", // Đổi tên để tránh trùng "Type"
                            width: "100px",
                            formatter: (e) => {
                                const date = new Date(e);
                                const formatted = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}:${date.getSeconds().toString().padStart(2, '0')}`;
                                return gridjs.html(`<p>${formatted}</p>`);
                            }
                        },
                        {
                            name: "Invoice",
                            width: "150px",
                            formatter: (e) => gridjs.html(`<button type="button" class="btn btn-sm btn-light" onclick="window.open('${e}', '_blank')">Details</button>`)
                        }
                    ],
                    pagination: {
                        enabled: true,
                        limit: 5,
                        summary: true
                    },
                    pageSize: [5, 10, 20, 50],
                    sort: true,
                    search: true,
                    data: data.map(u => [
                        u.No,
                        u.Before,
                        u.Change,
                        u.After,
                        u.Types,
                        u.Status,
                        u.Date,
                        u.Invoice
                    ])
                }).render(container);

                container.dataset.gridInitialized = "true";
 
                container.addEventListener("click", () => isInteracting = true); 
                container.addEventListener("input", () => isInteracting = true); 
                const paginationButtons = container.querySelectorAll(".gridjs-pagination .gridjs-pages button");
                paginationButtons.forEach(button => {
                    button.addEventListener("click", () => {
                        isInteracting = true;
                        console.log("Pagination button clicked, stopping updates"); 
                    });
                });

            
                const sortButtons = container.querySelectorAll(".gridjs-sort");
                sortButtons.forEach(button => {
                    button.addEventListener("click", () => {
                        isInteracting = true;
                        console.log("Sort button clicked, stopping updates"); 
                    });
                });



                container.addEventListener("mouseleave", () => isInteracting = false);
                container.addEventListener("blur", () => isInteracting = false, true); 

            }
        }

        // Khởi tạo bảng lần đầu
        initializeGrid(list);

        // Hàm lấy dữ liệu mới qua AJAX
        function fetchUpdatedData() {
            if (!isInteracting) { // Chỉ cập nhật khi không tương tác
                fetch('/Users/UpdateBalance', { // Thay bằng URL endpoint thực tế
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => response.json())
                    .then(newData => {
                        if (gridInstance) {
                            gridInstance.updateConfig({
                                data: newData.map(u => [
                                    u.no,
                                    u.before,
                                    u.change,
                                    u.after,
                                    u.types,
                                    u.status,
                                    u.date,
                                    u.invoice
                                ])
                            }).forceRender(); // Cập nhật dữ liệu mà không reload toàn bộ
                        }
                    })
                    .catch(error => console.error('Error fetching data:', error));
            }
        }

        // Cập nhật dữ liệu mỗi 5 giây
        setInterval(fetchUpdatedData, 500000);

        // Gọi lần đầu tiên ngay lập tức (tuỳ chọn)
        fetchUpdatedData();
    });
</script>

  <script type="text/javascript">
    $("#btnDeposit").on("click", function () {

        $('#btnDeposit').html('<i class="fa fa-spinner fa-spin"></i> Đang xử lý...')
            .prop('disabled', true);
        var checkbox = parseInt($("#numOrder").val(), 10);
        var token = $("input[name='__RequestVerificationToken']").val();

        if (isNaN(checkbox) || checkbox <= 0) {
            setTimeout(() => {
                new Notify({
                    status: 'error',
                    title: 'Thất Bại',
                    text: 'Số tiền nạp tối thiểu là 100,000 Vnd',
                    effect: 'fade',
                    speed: 300,
                    showIcon: true,
                    showCloseButton: true,
                    autoclose: true,
                    autotimeout: 3000,
                    position: 'right top'
                });

                $('#btnDeposit').html('Add Payment').prop('disabled', false);
            }, 100); 
            return;
        }

        $('#btnDeposit').html('<i class="fa fa-spinner fa-spin"></i> Đang xử lý...')
            .prop('disabled', true);

        $.ajax({
            url: "@Url.Action("AddBalance", "Users")",
            method: "POST",
            dataType: "JSON",
            data: {
                number: $("#numOrder").val(),
                __RequestVerificationToken: token
            },
            success: function (response) {
                if (response.success) {
                    Swal.fire({
                        title: 'Thành công!',
                        text: 'Bạn sẽ được chuyển hướng đến trang thanh toán...',
                        icon: 'success',
                        confirmButtonText: 'OK'
                    }).then((result) => {
                        if (result.isConfirmed || result.isDismissed) {
                            window.location.href = response.msg;
                        }
                    });

                } else {
                    Swal.fire(
                        'Thất bại',
                        response.msg,
                        'error'
                    );
                }
                $('#btnDeposit').html('Add Payment').prop('disabled', false);
            },
            error: function () {
                cuteToast({
                    type: "error",
                    message: 'Không thể xử lý',
                    timer: 5000
                });
                $('#btnDeposit').html('Add Payment').prop('disabled', false);
            }
        });
    });
</script>

<script type="text/javascript">
    $("#btnWithdraw").on("click", function () {
        $('#btnWithdraw').html('<i class="fa fa-spinner fa-spin"></i> Đang xử lý...')
            .prop('disabled', true);
        var checkbox = parseInt($("#numOrderVut").val(), 10);
        var token = $("input[name='__RequestVerificationToken']").val();

        if (isNaN(checkbox) || checkbox < 500000) {
            setTimeout(() => {
            new Notify({
                status: 'error',
                title: 'Thất Bại',
                text: 'Số tiền rút tối thiểu là 500,000 Vnd',
                effect: 'fade',
                speed: 300,
                showIcon: true,
                showCloseButton: true,
                autoclose: true,
                autotimeout: 3000,
                position: 'right top'
            });
            $('#btnWithdraw').html('Withdraw').prop('disabled', false);
        }, 100);
    return;

        }

        $('#btnWithdraw').html('<i class="fa fa-spinner fa-spin"></i> Đang xử lý...')
            .prop('disabled', true);

        $.ajax({
            url: "@Url.Action("Withdraw", "Users")",
            method: "POST",
            dataType: "JSON",
            data: {
                number: $("#numOrderVut").val(),
                nameAcc: $("#nameAcc").val(),
                numAccount: $("#umaccou").val(),
                code: $("#code").val(),
                __RequestVerificationToken: token
            },
            success: function (response) {
                if (response.success) {
                    new Notify({
                        status: 'success',
                        title: 'Thành công!',
                        text: response.msg || 'Gửi thành công!',
                        effect: 'fade',
                        speed: 300,
                        showIcon: true,
                        showCloseButton: true,
                        autoclose: true,
                        autotimeout: 3000,
                        position: 'right top'
                    });

                } else {
                    new Notify({
                        status: 'error',
                        title: 'Thất Bại',
                        text: response.msg || 'Gửi thất bại!',
                        effect: 'fade',
                        speed: 300,
                        showIcon: true,
                        showCloseButton: true,
                        autoclose: true,
                        autotimeout: 3000,
                        position: 'right top'
                    });
                }
                $('#btnWithdraw').html('Withdraw').prop('disabled', false);
            },
            error: function () {
                Swal.fire(
                    'Thất bại',
                    "Đã xảy ra lỗi",
                    'error'
                );
                $('#btnWithdraw').html('Withdraw').prop('disabled', false);
            }
        });
    });
</script>
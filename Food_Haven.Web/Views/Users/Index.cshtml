@using System.Text.Json
@model Repository.ViewModels.IndexUserViewModels

<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8" />
    <title>Nest - Multipurpose eCommerce HTML Template</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="" />
    <meta property="og:type" content="" />
    <meta property="og:url" content="" />
    <meta property="og:image" content="" />
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="~/assets/imgs/theme/favicon.svg" />
    <!-- Template CSS -->
    <link rel="stylesheet" href="~/assets/css/main.css?v=6.0" />

    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="chrome-extension://mooikfkahbdckldjjndioackbalphokd/~/assets/prompt.js"></script>
    @Html.Raw(" <link href='https://cdn.jsdelivr.net/npm/@flaticon/flaticon-uicons/css/all/all.css' rel='stylesheet'>")

      <link rel="stylesheet" href="~/assets/js/gridjs/theme/mermaid.min.css">
</head>

<body>
    <style>
        .gridjs-input {
            height: 42px !important;
        }

        .mr-2 {
            margin-right: 10px;
        }
        .badge.bg-kitchen { background-color: #17a2b8; } /* for Preparing In Kitchen */
.badge.bg-failed { background-color: #dc3545; } /* for Cancelled or Failed */

    </style>

    @await Html.PartialAsync("_Header")
    <div class="mobile-header-active mobile-header-wrapper-style">
        <div class="mobile-header-wrapper-inner">
            <div class="mobile-header-top">
                <div class="mobile-header-logo">
                    <a href="index.html"><img src="~/assets/imgs/theme/logo.svg" alt="logo" /></a>
                </div>
                <div class="mobile-menu-close close-style-wrap close-style-position-inherit">
                    <button class="close-style search-close">
                        <i class="icon-top"></i>
                        <i class="icon-bottom"></i>
                    </button>
                </div>
            </div>
            <div class="mobile-header-content-area">
                <div class="mobile-search search-style-3 mobile-header-border">
                    <form action="#">
                        <input type="text" placeholder="Search for items…" />
                        <button type="submit"><i class="fi-rs-search"></i></button>
                    </form>
                </div>
                <div class="mobile-menu-wrap mobile-header-border">
                    <!-- mobile menu start -->
                    <nav>
                        <ul class="mobile-menu font-heading">
                            <li class="menu-item-has-children">
                                <a href="index.html">Home</a>
                                <ul class="dropdown">
                                    <li><a href="index.html">Home 1</a></li>
                                    <li><a href="index-2.html">Home 2</a></li>
                                    <li><a href="index-3.html">Home 3</a></li>
                                    <li><a href="index-4.html">Home 4</a></li>
                                    <li><a href="index-5.html">Home 5</a></li>
                                    <li><a href="index-6.html">Home 6</a></li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children">
                                <a href="shop-grid-right.html">shop</a>
                                <ul class="dropdown">
                                    <li><a href="shop-grid-right.html">Shop Grid – Right Sidebar</a></li>
                                    <li><a href="shop-grid-left.html">Shop Grid – Left Sidebar</a></li>
                                    <li><a href="shop-list-right.html">Shop List – Right Sidebar</a></li>
                                    <li><a href="shop-list-left.html">Shop List – Left Sidebar</a></li>
                                    <li><a href="shop-fullwidth.html">Shop - Wide</a></li>
                                    <li class="menu-item-has-children">
                                        <a href="#">Single Product</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Product – Right Sidebar</a></li>
                                            <li><a href="shop-product-left.html">Product – Left Sidebar</a></li>
                                            <li><a href="shop-product-full.html">Product – No sidebar</a></li>
                                            <li><a href="shop-product-vendor.html">Product – Vendor Infor</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="shop-filter.html">Shop – Filter</a></li>
                                    <li><a href="shop-wishlist.html">Shop – Wishlist</a></li>
                                    <li><a href="shop-cart.html">Shop – Cart</a></li>
                                    <li><a href="shop-checkout.html">Shop – Checkout</a></li>
                                    <li><a href="shop-compare.html">Shop – Compare</a></li>
                                    <li class="menu-item-has-children">
                                        <a href="#">Shop Invoice</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-invoice-1.html">Shop Invoice 1</a></li>
                                            <li><a href="shop-invoice-2.html">Shop Invoice 2</a></li>
                                            <li><a href="shop-invoice-3.html">Shop Invoice 3</a></li>
                                            <li><a href="shop-invoice-4.html">Shop Invoice 4</a></li>
                                            <li><a href="shop-invoice-5.html">Shop Invoice 5</a></li>
                                            <li><a href="shop-invoice-6.html">Shop Invoice 6</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children">
                                <a href="#">Vendors</a>
                                <ul class="dropdown">
                                    <li><a href="vendors-grid.html">Vendors Grid</a></li>
                                    <li><a href="vendors-list.html">Vendors List</a></li>
                                    <li><a href="vendor-details-1.html">Vendor Details 01</a></li>
                                    <li><a href="vendor-details-2.html">Vendor Details 02</a></li>
                                    <li><a href="vendor-dashboard.html">Vendor Dashboard</a></li>
                                    <li><a href="vendor-guide.html">Vendor Guide</a></li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children">
                                <a href="#">Mega menu</a>
                                <ul class="dropdown">
                                    <li class="menu-item-has-children">
                                        <a href="#">Women's Fashion</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Dresses</a></li>
                                            <li><a href="shop-product-right.html">Blouses & Shirts</a></li>
                                            <li><a href="shop-product-right.html">Hoodies & Sweatshirts</a></li>
                                            <li><a href="shop-product-right.html">Women's Sets</a></li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children">
                                        <a href="#">Men's Fashion</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Jackets</a></li>
                                            <li><a href="shop-product-right.html">Casual Faux Leather</a></li>
                                            <li><a href="shop-product-right.html">Genuine Leather</a></li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children">
                                        <a href="#">Technology</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Gaming Laptops</a></li>
                                            <li><a href="shop-product-right.html">Ultraslim Laptops</a></li>
                                            <li><a href="shop-product-right.html">Tablets</a></li>
                                            <li><a href="shop-product-right.html">Laptop Accessories</a></li>
                                            <li><a href="shop-product-right.html">Tablet Accessories</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children">
                                <a href="blog-category-fullwidth.html">Blog</a>
                                <ul class="dropdown">
                                    <li><a href="blog-category-grid.html">Blog Category Grid</a></li>
                                    <li><a href="blog-category-list.html">Blog Category List</a></li>
                                    <li><a href="blog-category-big.html">Blog Category Big</a></li>
                                    <li><a href="blog-category-fullwidth.html">Blog Category Wide</a></li>
                                    <li class="menu-item-has-children">
                                        <a href="#">Single Product Layout</a>
                                        <ul class="dropdown">
                                            <li><a href="blog-post-left.html">Left Sidebar</a></li>
                                            <li><a href="blog-post-right.html">Right Sidebar</a></li>
                                            <li><a href="blog-post-fullwidth.html">No Sidebar</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children">
                                <a href="#">Pages</a>
                                <ul class="dropdown">
                                    <li><a href="page-about.html">About Us</a></li>
                                    <li><a href="page-contact.html">Contact</a></li>
                                    <li><a href="page-account.html">My Account</a></li>
                                    <li><a href="page-login.html">Login</a></li>
                                    <li><a href="page-register.html">Register</a></li>
                                    <li><a href="page-forgot-password.html">Forgot password</a></li>
                                    <li><a href="page-reset-password.html">Reset password</a></li>
                                    <li><a href="page-purchase-guide.html">Purchase Guide</a></li>
                                    <li><a href="page-privacy-policy.html">Privacy Policy</a></li>
                                    <li><a href="page-terms.html">Terms of Service</a></li>
                                    <li><a href="page-404.html">404 Page</a></li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children">
                                <a href="#">Language</a>
                                <ul class="dropdown">
                                    <li><a href="#">English</a></li>
                                    <li><a href="#">French</a></li>
                                    <li><a href="#">German</a></li>
                                    <li><a href="#">Spanish</a></li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                    <!-- mobile menu end -->
                </div>
                <div class="mobile-header-info-wrap">
                    <div class="single-mobile-header-info">
                        <a href="page-contact.html"><i class="fi-rs-marker"></i> Our location </a>
                    </div>
                    <div class="single-mobile-header-info">
                        <a href="page-login.html"><i class="fi-rs-user"></i>Log In / Sign Up </a>
                    </div>
                    <div class="single-mobile-header-info">
                        <a href="#"><i class="fi-rs-headphones"></i>(+01) - 2345 - 6789 </a>
                    </div>
                </div>
                <div class="mobile-social-icon mb-50">
                    <h6 class="mb-15">Follow Us</h6>
                    <a href="#"><img src="~/assets/imgs/theme/icons/icon-facebook-white.svg" alt="" /></a>
                    <a href="#"><img src="~/assets/imgs/theme/icons/icon-twitter-white.svg" alt="" /></a>
                    <a href="#"><img src="~/assets/imgs/theme/icons/icon-instagram-white.svg" alt="" /></a>
                    <a href="#"><img src="~/assets/imgs/theme/icons/icon-pinterest-white.svg" alt="" /></a>
                    <a href="#"><img src="~/assets/imgs/theme/icons/icon-youtube-white.svg" alt="" /></a>
                </div>
                <div class="site-copyright">Copyright 2024 © Nest. All rights reserved. Powered by AliThemes.</div>
            </div>
        </div>
    </div>
    <!--End header-->
    <main class="main pages">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="index.html" rel="nofollow"><i class="fi-rs-home mr-5"></i>Home</a>
                    <span></span> Pages <span></span> My Account
                </div>
            </div>
        </div>
        <div class="page-content pt-150 pb-150">
            <div class="container">
                <div class="row">
                    <div class="col-lg-11 m-auto">
                        <div class="row">
                            <div class="col-md-2">
                                <div class="dashboard-menu">
                                    <ul class="nav flex-column" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab"
                                               href="#dashboard" role="tab" aria-controls="dashboard"
                                               aria-selected="false">
                                                <i class="fi-rs-settings-sliders mr-10"></i>Dashboard
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders"
                                               role="tab" aria-controls="orders" aria-selected="false">
                                                <i class="fi-rs-shopping-bag mr-10"></i>Orders
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="order-details-tab" data-bs-toggle="tab" href="#order-details" role="tab" aria-controls="order-details" aria-selected="false" style="display: none;">
                                                <i class="fi-rs-shopping-bag mr-10"></i>Order Details
                                            </a>
                                        </li>

                                        <li class="nav-item">
                                            <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab"
                                               href="#track-orders" role="tab" aria-controls="track-orders"
                                               aria-selected="false">
                                                <i class="fi-rs-shopping-cart-check mr-10"></i>Track Your Order
                                            </a>
                                        </li>
                                       
                                        @if (Model.userView.RequestSeller == "0" || Model.userView.RequestSeller == "1" || Model.userView.RequestSeller == "3") // Nếu chưa đăng ký seller
                                        {
                                            <li class="nav-item">
                                                <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address"
                                                   role="tab" aria-controls="address" aria-selected="true">
                                                    <i class="fi-rs-marker mr-10"></i>Register Seller
                                                </a>
                                            </li>
                                        } else
                                        {
                                            <li class="nav-item">
                                                <a class="nav-link" id="address-tab" target="_blank" asp-controller="Seller" asp-action="viewstore"
                                                   role="tab" aria-controls="address" aria-selected="true">
                                                    <i class="fi-rs-marker mr-10"></i>Management Seller
                                                </a>
                                            </li>
                                        }
                                        <li class="nav-item">
                                            <a class="nav-link" id="account-detail-tab" data-bs-toggle="tab"
                                               href="#account-detail" role="tab" aria-controls="account-detail"
                                               aria-selected="true"><i class="fi-rs-user mr-10"></i>Account details</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="wallet-tab" data-bs-toggle="tab" href="#wallet"
                                               role="tab" aria-controls="wallet" aria-selected="true">
                                                <i class="fi-rs-user mr-10"></i>Wallet
                                            </a>
                                        </li>
                                     <li class="nav-item" role="presentation">
                                        <a class="nav-link" id="Recipe-tab" data-bs-toggle="tab"
                                        href="#Recipe" role="tab" aria-controls="Recipe"
                                        aria-selected="true">
                                            <i class="fi-rs-user me-2"></i>Recipe
                                        </a>
                                    </li>
                                        @* <li class="nav-item"> 
                                            <a class="nav-link" id="Feedback-tab" data-bs-toggle="tab" href="#Feedback"
                                               role="tab" aria-controls="Feedback" aria-selected="false">
                                                <i class="fi-rs-shopping-bag mr-10"></i>Your Feedback
                                            </a>
                                        </li>*@
                                        <li class="nav-item">
                                            <a class="nav-link" href="page-login.html">
                                                <i class="fi-rs-sign-out mr-10"></i>Logout
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-10">
                                <div class="tab-content account dashboard-content pl-50">
                                    <div class="tab-pane fade active show" id="dashboard" role="tabpanel"
                                             aria-labelledby="dashboard-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="mb-0">Hello Rosie!</h3>
                                            </div>
                                            <div class="card-body">
                                                <p>
                                                    From your account dashboard. you can easily check &amp; view your <a href="#">recent orders</a>,<br />
                                                    manage your <a href="#">shipping and billing addresses</a> and <a href="#">edit your password and account details.</a>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade show" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="mb-0">Your Orders</h3>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive" id="table-orders"></div>
                                            </div>
                                        </div>
                                    </div>

                                   <div class="tab-pane fade" id="order-details" role="tabpanel" aria-labelledby="order-details-tab">
    <div class="card">
        <div class="card-header">
            <h3 class="mb-0">Order Details</h3>
        </div>
        <div class="card-body">
            <div class="table-responsive" id="table-order-details"></div>
        </div>
    </div>
</div>

                            <script>
    let detailsGrid = null;

    document.addEventListener("DOMContentLoaded", function () {
        const orderContainer = document.getElementById("table-orders");
        orderContainer.innerHTML = "";

        const orderData = @Html.Raw(JsonSerializer.Serialize(Model.OrderViewodels));
        let sttCounter = 1;

        new gridjs.Grid({
            columns: [
                { name: "STT", width: "60px" },
                { name: "Order Tracking", width: "160px" },
                { name: "Payment Method", width: "130px" },
                {
                    name: "Status Payment",
                    width: "160px",
                    formatter: (cell) => {
                        const value = (cell || "").toLowerCase();
                        let color = "secondary";
                        if (value === "success") color = "success";
                        else if (value === "failed") color = "danger";
                        else if (value === "waiting payment") color = "warning";
                        return gridjs.html(`<span class="badge bg-${color}">${cell}</span>`);
                    }
                },
                {
                    name: "Order Status",
                    width: "180px",
                    formatter: (cell) => {
                        const value = (cell || "").toLowerCase();
                        let color = "secondary";
                        switch (value) {
                            case "pending": color = "warning"; break;
                            case "preparing in kitchen": color = "info"; break;
                            case "delivering": color = "primary"; break;
                            case "confirmed": color = "success"; break;
                            case "cancelled by user":
                            case "cancelled by restaurant":
                            case "delivery failed": color = "danger"; break;
                            case "refunded": color = "dark"; break;
                        }
                        return gridjs.html(`<span class="badge bg-${color}">${cell}</span>`);
                    }
                },
                { name: "Quantity", width: "90px" },
                {
                    name: "Total",
                    width: "120px",
                    formatter: (cell) => parseFloat(cell).toLocaleString("vi-VN", {
                        style: "currency", currency: "VND"
                    })
                },
                {
                    name: "Order Date",
                    width: "180px",
                    formatter: (cell) => {
                        const date = new Date(cell);
                        return date.toLocaleDateString("vi-VN") + " " + date.toLocaleTimeString("vi-VN");
                    }
                },
                {
                    name: "Delivery Date",
                    width: "180px",
                    formatter: (cell) => {
                        if (!cell) return "";
                        const date = new Date(cell);
                        return date.toLocaleDateString("vi-VN") + " " + date.toLocaleTimeString("vi-VN");
                    }
                },
                { name: "Note", width: "200px" },
                { name: "Delivery Address", width: "220px" },
                { name: "Description", width: "220px" },
                {
                    name: "Actions",
                    width: "130px",
                    formatter: (_, row) => {
                        const orderId = row.cells[1].data;
                        return gridjs.html(`
                            <button class="btn btn-sm btn-primary view-details"
                                    data-id="${orderId}">
                                View Order
                            </button>`);
                    }
                }
            ],
            pagination: { enabled: true, limit: 5, summary: true },
            search: true,
            sort: true,
            data: orderData.map((o, index) => [
                sttCounter++,
                o.OrderTracking,
                o.PaymentMethod,
                o.StatusPayment,
                o.Status,
                o.Quantity,
                o.Total,
                o.OrderDate,
                o.DeliveryDate,
                o.Note,
                o.DeliveryAddress,
                o.Desctiption,
                ""
            ])
        }).render(orderContainer);

        document.addEventListener("click", function (e) {
            if (e.target.classList.contains("view-details")) {
                const orderId = e.target.getAttribute("data-id");
                loadOrderDetails(orderId);
            }
        });

function loadOrderDetails(orderId) {
    fetch("/Users/GetOrderDetails", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Accept": "application/json"
        },
        body: JSON.stringify(orderId),
        cache: "no-store"
    })
    .then(response => {
        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
        return response.json();
    })
    .then(data => {
        if (data.success) {
            const detailsContainer = document.getElementById("table-order-details");
            detailsContainer.innerHTML = "";

            if (detailsGrid) {
                detailsGrid.destroy();
            }

            let sttCounter = 1;

            detailsGrid = new gridjs.Grid({
                columns: [
                    { name: "STT", width: "60px" },
                    { name: "Product Name", width: "250px" },
                    { name: "Product Price", width: "150px" },
                    { name: "Total Price", width: "150px" },
                    { name: "Quantity", width: "100px" },
                    {
                        name: "Status",
                        width: "150px",
                        formatter: (cell) => {
                            const value = (cell || "").toLowerCase();
                            let color = "secondary";
                            switch (value) {
                                case "pending": color = "warning"; break;
                                case "preparing in kitchen": color = "info"; break;
                                case "delivering": color = "primary"; break;
                                case "confirmed": color = "success"; break;
                                case "cancelled by user":
                                case "cancelled by restaurant":
                                case "delivery failed": color = "danger"; break;
                                case "refunded": color = "dark"; break;
                            }
                            return gridjs.html(`<span class="badge bg-${color}">${cell}</span>`);
                        }
                    }
                ],
                pagination: { enabled: true, limit: 5, summary: true },
                search: true,
                sort: true,
                data: data.data.map((od) => [
                    sttCounter++,
                    od.productName,
                    od.productPrice,
                    od.totalPrice,
                    od.quantity,
                    od.status
                ])
            });

            detailsGrid.render(detailsContainer);

            const orderDetailsTab = new bootstrap.Tab(document.getElementById("order-details-tab"));
            orderDetailsTab.show();

            // Xóa các nút cũ nếu có
            document.getElementById("back-to-orders-btn")?.remove();
            document.getElementById("cancel-entire-order-btn")?.remove();
            document.getElementById("feedback-order-btn")?.remove();

            // Lấy trạng thái đơn hàng từ server
            const orderStatus = (data.orderStatus || "").toLowerCase();

            // 👉 Nếu là "pending" → hiển thị nút "Hủy đơn"
            if (orderStatus === "pending") {
                const cancelAllBtn = document.createElement("button");
                cancelAllBtn.id = "cancel-entire-order-btn";
                cancelAllBtn.className = "btn btn-danger mt-3 float-end";
                cancelAllBtn.innerHTML = "<i class='fi fi-rs-trash'></i> Hủy đơn hàng";
                cancelAllBtn.onclick = function () {
                    Swal.fire({
                        title: "Xác nhận hủy đơn?",
                        text: "Toàn bộ đơn hàng này sẽ bị hủy!",
                        icon: "warning",
                        showCancelButton: true,
                        confirmButtonText: "Hủy đơn",
                        cancelButtonText: "Không",
                        confirmButtonColor: "#d33",
                        cancelButtonColor: "#6c757d"
                    }).then((result) => {
                        if (result.isConfirmed) {
                            fetch("/Users/CancelOrder", {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                    "Accept": "application/json"
                                },
                                body: JSON.stringify(orderId)
                            })
                            .then(res => res.json())
                            .then(data => {
                                if (data.success) {
                                    Swal.fire("Đã hủy!", data.message || "Đơn hàng đã được hủy.", "success")
                                        .then(() => {
                                            document.getElementById("orders-tab")?.click();
                                        });
                                } else {
                                    Swal.fire("Lỗi!", data.message || "Không thể hủy đơn hàng.", "error");
                                }
                            })
                            .catch(error => {
                                console.error("Cancel error:", error);
                                Swal.fire("Lỗi!", "Đã xảy ra lỗi khi gửi yêu cầu hủy.", "error");
                            });
                        }
                    });
                };
                detailsContainer.appendChild(cancelAllBtn);
            }

            // 👉 Nếu là "confirmed" → hiển thị nút "Gửi đánh giá"
            else if (orderStatus === "confirmed") {
                const feedbackBtn = document.createElement("button");
                feedbackBtn.id = "feedback-order-btn";
                feedbackBtn.className = "btn btn-success mt-3 float-end";
                feedbackBtn.innerHTML = "<i class='fi fi-rs-star'></i> Gửi đánh giá";
                feedbackBtn.onclick = function () {
                    const modal = new bootstrap.Modal(document.getElementById("showModal"));
                    modal.show();
                    document.getElementById("order_id-field").value = orderId;
                };
                detailsContainer.appendChild(feedbackBtn);
            }

            // Nút quay lại luôn hiển thị
            const backButton = document.createElement("button");
            backButton.id = "back-to-orders-btn";
            backButton.className = "btn btn-secondary mt-3 me-2";
            backButton.innerHTML = "<i class='fi fi-rs-arrow-left'></i> Quay lại Orders";
            backButton.onclick = function () {
                document.getElementById("orders-tab")?.click();
            };
            detailsContainer.appendChild(backButton);

        } else {
            alert("Không tìm thấy chi tiết đơn hàng.");
            console.log("Lỗi trả về:", data.message);
        }
    })
    .catch(error => {
        console.error("Fetch error:", error);
        alert("Đã xảy ra lỗi khi tải chi tiết đơn hàng.");
    });
}




    });


document.addEventListener("click", function (e) {
    if (e.target.classList.contains("cancel-order")) {
        const orderId = e.target.getAttribute("data-id");

        Swal.fire({
            title: "Xác nhận hủy đơn?",
            text: "Bạn sẽ không thể hoàn tác hành động này!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Hủy đơn",
            cancelButtonText: "Không",
            confirmButtonColor: "#d33",
            cancelButtonColor: "#6c757d"
        }).then((result) => {
            if (result.isConfirmed) {
                fetch("/Users/CancelOrder", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Accept": "application/json"
                    },
                    body: JSON.stringify(orderId)
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        Swal.fire("Đã hủy!", data.message || "Đơn hàng đã được hủy.", "success").then(() => {
                            document.getElementById("orders-tab").click(); // Quay lại danh sách đơn
                        });
                    } else {
                        Swal.fire("Lỗi!", data.message || "Không thể hủy đơn hàng.", "error");
                    }
                })
                .catch(error => {
                    console.error("Cancel error:", error);
                    Swal.fire("Lỗi!", "Đã xảy ra lỗi khi gửi yêu cầu hủy.", "error");
                });
            }
        });
    }
});




</script>

 <div class="modal fade" id="showModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0">
            <div class="modal-header bg-info-subtle p-3">
                <h5 class="modal-title" id="exampleModalLabel">Enter Your Review</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="close-modal"></button>
            </div>
            <form class="tablelist-form" autocomplete="off">
                <div class="modal-body">
                    <input type="hidden" id="id-field" />
                    <input type="hidden" id="product_id-field" /> <!-- Lưu ProductId -->
                    <div class="row g-3">
                        <div class="col-lg-6">
                            <div>
                                <label for="email_id-field" class="form-label">User Name</label>
                                <input type="text" id="email_id-field" class="form-control" placeholder="User Name" required />
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div>
                                <label for="product_name-field" class="form-label">Product Name</label>
                                <input type="text" id="product_name-field" class="form-control" placeholder="Product Name" required />
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <div>
                                <label for="company_name-field" class="form-label">Your Reply</label>
                                <input type="text" id="company_name-field" class="form-control" placeholder="Your Reply" required />
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <div>
                                <label class="form-label">Star Rating</label>
                                <div class="star-rating" id="star-rating">
                                    <span class="star" data-value="1">&#9733;</span>
                                    <span class="star" data-value="2">&#9733;</span>
                                    <span class="star" data-value="3">&#9733;</span>
                                    <span class="star" data-value="4">&#9733;</span>
                                    <span class="star" data-value="5">&#9733;</span>
                                </div>
                                <input type="hidden" id="designation-field" name="starRating" value="0" required /> <!-- Lưu giá trị rating -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="hstack gap-2 justify-content-end">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-success" id="add-btn">Add Review</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<style>
.star-rating {
    font-size: 24px;
    color: #ddd; /* Màu mặc định của sao (chưa chọn) */
    cursor: pointer;
    display: inline-flex;
    gap: 5px;
}

.star-rating .star:hover,
.star-rating .star:hover ~ .star,
.star-rating .star.selected {
    color: #f5c518; /* Màu vàng khi hover hoặc được chọn */
}

.star-rating .star.selected {
    color: #f5c518; /* Màu vàng cho sao đã chọn */
}
</style>


                                    <div class="tab-pane fade" id="track-orders" role="tabpanel"
                                         aria-labelledby="track-orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="mb-0">Orders tracking</h3>
                                            </div>
                                            <div class="card-body contact-from-area">
                                                <p>
                                                    To track your order please enter your OrderID in the box below and
                                                    press "Track" button. This was given to you on your receipt and in
                                                    the confirmation email you should have received.
                                                </p>
                                                <div class="row">
                                                    <div class="col-lg-8">
                                                        <form class="contact-form-style mt-30 mb-50" action="#"
                                                              method="post">
                                                            <div class="input-style mb-20">
                                                                <label>Order ID</label>
                                                                <input name="order-id"
                                                                       placeholder="Found in your order confirmation email"
                                                                       type="text" />
                                                            </div>
                                                            <div class="input-style mb-20">
                                                                <label>Billing email</label>
                                                                <input name="billing-email"
                                                                       placeholder="Email you used during checkout"
                                                                       type="email" />
                                                            </div>
                                                            <button class="submit submit-auto-width"
                                                                    type="submit">
                                                                Track
                                                            </button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="address" role="tabpanel"
                                         aria-labelledby="address-tab">
                                        <div class="row justify-content-center">
                                            <div class="col-lg-8">
                                                @if (Model.userView.RequestSeller == "0") // Nếu chưa đăng ký seller
                                                {
                                                    <div class="card shadow-sm border-0">
                                                        <div class="card-header bg-warning text-dark text-center">
                                                            <h4 class="mb-0">Become a Seller</h4>
                                                        </div>
                                                        <div class="card-body text-center">
                                                            <p class="text-muted">
                                                                Unlock new opportunities by selling your products on our platform.
                                                            </p>
                                                            <button class="btn btn-success mt-2" id="btnRegisterSeller">Register as Seller</button>
                                                        </div>
                                                    </div>
                                                }
                                               else if (Model.userView.RequestSeller == "1") // Pending approval
                                                {
                                                    <div class="alert alert-info mt-3" id="approvalMessage">
                                                        <h5>Announcement!</h5>
                                                        <p>Your request has been submitted. Please wait for admin approval.</p>
                                                    </div>
                                                }
                                                else if (Model.userView.RequestSeller?.Trim() == "3") // Rejected
                                                {
                                                    <div class="alert alert-danger mt-3" id="rejectedMessage">
                                                        <h5>Rejected!</h5>
                                                        <p>Your request to become a seller has been denied. Please contact support for more information.</p>
                                                    </div>
                                                }
                                            </div>

                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="account-detail" role="tabpanel"
                                         aria-labelledby="account-detail-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5>Account Details</h5>
                                            </div>
                                            <div class="card-body">
                                                <form id="updateProfileForm">
                                                    <div class="row">
                                                      <div class="form-group col-md-6">
                                                            <label>First Name <span class="required">*</span></label>
                                                            <input required class="form-control" id="FirstName" name="FirstName" type="text" value="@Model.userView.FirstName"/>
                                                        </div>
                                                           <div class="form-group col-md-6">
                                                            <label>Last Name <span class="required">*</span></label>
                                                            <input required class="form-control" id="LastName" name="LastName" type="text" value="@Model.userView.LastName"/>
                                                        </div>
                                                        <div class="form-group col-md-6">
                                                            <label>UserName <span class="required">*</span></label>
                                                            <input required class="form-control" id="UserName" name="UserName" type="text" value="@Model.userView.UserName" readonly/>
                                                        </div>
                                                        <div class="form-group col-md-6">
                                                            <label>Email <span class="required">*</span></label>
                                                            <input required class="form-control" id="Email" name="Email" type="text" value="@Model.userView.Email" readonly/>
                                                        </div>
                                                        <div class="form-group col-md-6">
                                                            <label>Phone Number <span class="required">*</span></label>
                                                            <input 
                                                                class="form-control" 
                                                                id="PhoneNumber" 
                                                                name="PhoneNumber" 
                                                                type="text" 
                                                                value="@Model.userView.PhoneNumber"
                                                                inputmode="numeric"
                                                                oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                                                                maxlength="10" 
                                                                required
                                                            />
                                                        </div>
                                                          <div class="form-group col-md-6">
                                                            <label>Birthday <span class="required">*</span></label>
                                                            <input  class="form-control" id="Birthday" name="Birthday" type="date" value="@(Model.userView.Birthday != null ? Model.userView.Birthday.Value.ToString("yyyy-MM-dd") : "")" />
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                            <label>Address <span class="required">*</span></label>
                                                            <textarea class="form-control" id="Address" name="Address" rows="3">@Model.userView.Address</textarea>
                                                        </div>
                                                        @* <div class="form-group col-md-12">
                                                        <label>
                                                        Current Password <span class="required">*</span>
                                                        </label>
                                                        <input required="" class="form-control" name="password"
                                                        type="password" />
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                        <label>New Password <span class="required">*</span></label>
                                                        <input required="" class="form-control" name="npassword"
                                                        type="password" />
                                                        </div>
                                                        <div class="form-group col-md-12">
                                                        <label>
                                                        Confirm Password <span class="required">*</span>
                                                        </label>
                                                        <input required="" class="form-control" name="cpassword"
                                                        type="password" />
                                                        </div> *@
                                                        <div class="col-md-12">
                                                            <button type="submit"
                                                                    class="btn btn-fill-out submit font-weight-bold"
                                                                    name="submit" value="Submit">
                                                                Save Change
                                                            </button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="tab-pane fade" id="wallet" role="tabpanel" aria-labelledby="wallet-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="mb-0">Your Balance : <span id="balance-display">@Model.BalanceUser vnd</span></h3>
                                            </div>
                                            <div class="container mt-4">

                                                <div class="row mb-4">
                                                    <div class="col-md-12">
                                                        <button class="btn btn-success mr-2" id="depositBtn">
                                                            Nạp
                                                            Tiền
                                                        </button>
                                                        <button class="btn btn-danger" id="withdrawBtn">
                                                            Rút
                                                            Tiền
                                                        </button>
                                                    </div>
                                                </div>

                                                <!-- Forms container -->
                                                <div class="row">
                                                    @Html.AntiForgeryToken()
                                                    <div class="col-md-6" id="depositForm" style="display: none;">
                                                        <div class="card shadow-sm">
                                                            <div class="card-header">
                                                                <h5 class="mb-0">Nạp Tiền</h5>
                                                            </div>
                                                            <div class="card-body">
                                                                <label class="form-label">
                                                                    <p>Số tiền nạp</p>
                                                                </label>
                                                                <input type="number" id="numOrder" class="form-control mb-3">
                                                                <label class="form-label">
                                                                    <p>Hình thức thanh toán</p>
                                                                </label>
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="radio"
                                                                           name="paymentType" checked>
                                                                    <label class="form-check-label">
                                                                        <p>Online payment</p>
                                                                    </label>
                                                                </div>
                                                                <button id="btnDeposit" class="btn btn-success mt-3 w-100">
                                                                    Nạp
                                                                    Tiền
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Rút tiền form -->
                                                    <div class="col-md-6" id="withdrawForm" style="display: none;">
                                                        <div class="card shadow-sm">
                                                            <div class="card-header">
                                                                <h5 class="mb-0">
                                                                    Rút Tiền
                                                                </h5>
                                                            </div>
                                                            <div class="card-body">
                                                                <label class="form-label">
                                                                    <p>Số tiền rút</p>
                                                                </label>
                                                                <input type="text" class="form-control mb-3" id="numOrderVut">
                                                                <label class="form-label">
                                                                    <p>Phương thức rút</p>
                                                                </label>
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="radio"
                                                                           name="withdrawType" checked>
                                                                    <label class="form-check-label">
                                                                        <p>
                                                                            Chuyển khoản ngân
                                                                            hàng
                                                                        </p>
                                                                    </label>
                                                                </div>
                                                                <label class="form-label">
                                                                    <p>Ngân Hàng</p>
                                                                </label>

                                                                <div class="custom_select">
                                                                    <select class="form-control select-active w-100" id="code">
                                                                        <option value="">United Kingdom</option>
                                                                        <option value="TT">Trinidad and Tobago</option>
                                                                        <option value="TN">Tunisia</option>
                                                                        <option value="TR">Turkey</option>
                                                                        <option value="TM">Turkmenistan</option>
                                                                        <option value="TC">
                                                                            Turks and Caicos Islands
                                                                        </option>
                                                                        <option value="TV">Tuvalu</option>
                                                                        <option value="UG">Uganda</option>
                                                                        <option value="UA">Ukraine</option>
                                                                        <option value="AE">United Arab Emirates</option>
                                                                        <option value="GB">United Kingdom (UK)</option>
                                                                        <option value="US">USA (US)</option>
                                                                        <option value="UY">Uruguay</option>
                                                                        <option value="UZ">Uzbekistan</option>
                                                                        <option value="VU">Vanuatu</option>
                                                                        <option value="VA">Vatican</option>
                                                                        <option value="VE">Venezuela</option>
                                                                        <option value="VN">Vietnam</option>
                                                                        <option value="WF">Wallis and Futuna</option>
                                                                        <option value="EH">Western Sahara</option>
                                                                        <option value="WS">Western Samoa</option>
                                                                        <option value="YE">Yemen</option>
                                                                        <option value="ZM">Zambia</option>
                                                                        <option value="ZW">Zimbabwe</option>
                                                                    </select>
                                                                </div>
                                                                <label class="form-label mt-3">
                                                                    <p>
                                                                        Tên tài khoản
                                                                        nhận
                                                                    </p>
                                                                </label>
                                                                <input type="text" class="form-control" id="nameAcc">
                                                                <label class="form-label mt-3">
                                                                    <p>Số tài khoản</p>
                                                                </label>
                                                                <input type="text" class="form-control" id="umaccou">
                                                                <button id="btnWithdraw" class="btn btn-danger mt-3 w-100">
                                                                    Rút
                                                                    Tiền
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <script>
                                                        document.addEventListener("DOMContentLoaded", function () {
                                                            const bankSelect = document.querySelector(".custom_select select");

                                                            async function fetchBanks() {
                                                                try {
                                                                    const response = await fetch("https://api.vietqr.io/v2/banks");
                                                                    const result = await response.json();

                                                                    if (result.code === "00" && result.data.length > 0) {
                                                                        bankSelect.innerHTML = ""; 

                                                                        result.data.forEach(bank => {
                                                                            const option = document.createElement("option");
                                                                            option.value = bank.code;  
                                                                            option.textContent = `${bank.name} (${bank.shortName})`;
                                                                            bankSelect.appendChild(option);
                                                                        });
                                                                    }
                                                                } catch (error) {
                                                                    console.error("Lỗi khi lấy danh sách ngân hàng:", error);
                                                                }
                                                            }

                                                            fetchBanks();
                                                        });
                                                    </script>
                                                </div>

                                                <!-- Transactions List -->
                                                <div class="card mt-4 w-100">
                                                    <div class="card-header d-flex justify-content-between align-items-center">
                                                        <h5>Transactions List</h5>
                                                    </div>
                                                    <div class="card-body w-100" id="Exampletable">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <script>
                                            const depositBtn = document.getElementById('depositBtn');
                                            const withdrawBtn = document.getElementById('withdrawBtn');
                                            const depositForm = document.getElementById('depositForm');
                                            const withdrawForm = document.getElementById('withdrawForm');
                                            const selectElement = withdrawForm.querySelector('select');

                                            // Function to hide both forms
                                            function hideForms() {
                                                depositForm.style.display = 'none';
                                                withdrawForm.style.display = 'none';
                                            }

                                            // Show deposit form
                                            depositBtn.addEventListener('click', function (e) {
                                                e.stopPropagation();
                                                if (depositForm.style.display === 'block') {
                                                    depositForm.style.display = 'none';
                                                } else {
                                                    hideForms();
                                                    depositForm.style.display = 'block';
                                                }
                                            });

                                            // Show withdraw form
                                            withdrawBtn.addEventListener('click', function (e) {
                                                e.stopPropagation();
                                                if (withdrawForm.style.display === 'block') {
                                                    withdrawForm.style.display = 'none';
                                                } else {
                                                    hideForms();
                                                    withdrawForm.style.display = 'block';
                                                }
                                            });

                                            document.addEventListener('click', function (e) {
                                                const isClickInsideSelect = selectElement && (selectElement.contains(e.target) || e.target.tagName === 'OPTION');
                                                const isClickInsideInput = e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA';

                                                if (!depositBtn.contains(e.target) &&
                                                    !withdrawBtn.contains(e.target) &&
                                                    !depositForm.contains(e.target) &&
                                                    !withdrawForm.contains(e.target) &&
                                                    !isClickInsideSelect &&
                                                    !isClickInsideInput) {
                                                    hideForms();
                                                }
                                            });


                                            // Prevent form clicks from closing the form
                                            depositForm.addEventListener('click', function (e) {
                                                e.stopPropagation();
                                            });

                                            withdrawForm.addEventListener('click', function (e) {
                                                e.stopPropagation();
                                            });

                                            // Handle select element specifically
                                            if (selectElement) {
                                                selectElement.addEventListener('click', function (e) {
                                                    e.stopPropagation();
                                                });

                                                selectElement.addEventListener('focus', function (e) {
                                                    e.stopPropagation();
                                                });

                                                selectElement.addEventListener('change', function (e) {
                                                    e.stopPropagation();
                                                });

                                                // Handle key events for search/filter in select
                                                selectElement.addEventListener('keydown', function (e) {
                                                    e.stopPropagation();
                                                });
                                            }

                                            // Keep form visible when interacting with inputs
                                            const inputs = document.querySelectorAll('#depositForm input, #withdrawForm input');
                                            inputs.forEach(input => {
                                                input.addEventListener('click', function (e) {
                                                    e.stopPropagation();
                                                });
                                                input.addEventListener('focus', function (e) {
                                                    e.stopPropagation();
                                                });
                                                input.addEventListener('keydown', function (e) {
                                                    e.stopPropagation();
                                                });
                                            });
                                        </script>

                                        <style>
                                            .mr-2 {
                                                margin-right: 10px;
                                            }

                                            .custom_select .select2-container--default .select2-selection--single {
                                                width: 484.8px;
                                            }

                                            .custom_select .select2-container {
                                                max-width: 484.8px;
                                            }
                                        </style>
                                    </div>
                             <!-- Recipe Modal -->
                <div class="modal fade" id="recipeModal" tabindex="-1" aria-labelledby="recipeModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="recipeModalLabel">Add Recipe</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

          <form id="recipeForm">
    <div class="modal-body">
            <div class="card-body">
                                    <div class="live-preview">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="firstNameinput" class="form-label">Title</label>
                                                    <input type="text" class="form-control"
                                                        placeholder="Enter recipe title" id="firstNameinput">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="phonenumberInput" class="form-label">Servings</label>
                                                    <input type="tel" class="form-control" placeholder="Enter servings"
                                                        id="phonenumberInput">
                                                </div>
                                            </div>

                                            <div class="col-md-12">
                                                <div class="mb-3">
                                                    <label for="meassageInput" class="form-label">Short
                                                        Description</label>
                                                    <textarea class="form-control" id="meassageInput" rows="3"
                                                        placeholder="Enter short description"></textarea>
                                                </div>
                                            </div>

                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="emailidInput" class="form-label">Recipes Made It
                                                        Count</label>
                                                    <input type="email" class="form-control" placeholder="Enter number"
                                                        id="emailidInput" readonly>
                                                </div>
                                            </div>

                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="ForminputState" class="form-label">Category</label>
                                                    <select id="ForminputState" class="form-select" data-choices
                                                        data-choices-sorting="true">
                                                        <option selected>Choose...</option>
                                                        <option>...</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="ForminputState" class="form-label">Difficulty
                                                        Level</label>
                                                    <select id="ForminputState" class="form-select" data-choices
                                                        data-choices-sorting="true">
                                                        <option selected>Choose...</option>
                                                        <option>...</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="col-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="gridCheck">
                                                    <label class="form-check-label" for="gridCheck">
                                                        Is Active
                                                    </label>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <!-- Cột phải: Ingredient Tag -->
                                                <div class="col-md-6" style="margin-bottom: 20px;">
                                                    <div class="mb-3 h-100 d-flex flex-column">
                                                        <label class="form-label">Ingredient Tag</label>
                                                        <select required multiple="multiple" id="multiselect-header"
                                                            class="form-select flex-grow-1" size="10">
                                                            <option>Chevrolet</option>
                                                            <option>Fiat</option>
                                                            <option>Ford</option>
                                                            <option>Honda</option>
                                                            <option selected>Hyundai</option>
                                                            <option>Kia</option>
                                                            <option>Mahindra</option>
                                                            <option>Maruti</option>
                                                            <option>Mitsubishi</option>
                                                            <option>MG</option>
                                                            <option>Nissan</option>
                                                            <option>Renault</option>
                                                            <option selected>Skoda</option>
                                                            <option selected>Tata</option>
                                                            <option selected>Toyato</option>
                                                            <option>Volkswagen</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <!-- Cột trái: 3 time input -->
                                                <div class="col-md-6">
                                                    <!-- Preparation Time -->
                                                    <div class="mb-2">
                                                        <label class="form-label">Preparation Time</label>
                                                        <div class="d-flex gap-2">
                                                            <input type="number" id="prepHour" class="form-control"
                                                                min="0" max="23" placeholder="Hour"
                                                                style="width: 100px;">
                                                            <input type="number" id="prepMinute" class="form-control"
                                                                min="0" max="59" placeholder="Minute"
                                                                style="width: 100px;">
                                                            
                                                        </div>
                                                    </div>

                                                    <!-- Cooking Time -->
                                                    <div class="mb-2">
                                                        <label class="form-label">Cooking Time</label>
                                                        <div class="d-flex gap-2">
                                                            <input type="number" id="cookHour" class="form-control"
                                                                min="0" max="23" placeholder="Hour"
                                                                style="width: 100px;">
                                                            <input type="number" id="cookMinute" class="form-control"
                                                                min="0" max="59" placeholder="Minute"
                                                                style="width: 100px;">
                                                            
                                                        </div>
                                                    </div>

                                                    <!-- Total Time -->
                                                    <div class="mb-2">
                                                        <label class="form-label">Total Time</label>
                                                        <div class="d-flex gap-2">
                                                            <input type="number" id="totalHour" class="form-control"
                                                                min="0" max="23" placeholder="Hour"
                                                                style="width: 100px;">
                                                            <input type="number" id="totalMinute" class="form-control"
                                                                min="0" max="59" placeholder="Minute"
                                                                style="width: 100px;">
                                                            
                                                        </div>
                                                    </div>
                                                </div>


                                            </div>


                                        </div><!-- end inner row -->
                                    </div><!-- end live-preview -->
                                </div><!-- end card-body -->

        <!-- Ingredient Editor -->
             <div class="card">
                        <div class="card-header">
                            <h4 class="card-title mb-0">Ingredient</h4>
                        </div><!-- end card header -->

                        <div class="card-body">
                            <div id="editor-Ingredient" class="snow-editor" style="height: 300px;">
                                <h3><span class="ql-size-large">Hello World!</span></h3>
                                <p><br></p>
                                <h3>This is an simple editable area.</h3>
                                <p><br></p>
                                <ul>
                                    <li>
                                        Select a text to reveal the toolbar.
                                    </li>
                                    <li>
                                        Edit rich document on-the-fly, so elastic!
                                    </li>
                                </ul>
                                <p><br></p>
                                <p>
                                    End of simple area
                                </p>

                            </div> <!-- end Snow-editor-->
                        </div><!-- end card-body -->
                    </div><!-- end card -->

        <!-- Cooking Step Editor -->
        <div class="card">
            <div class="card-header">
                <h4 class="card-title mb-0">Cooking Step</h4>
            </div>
            <div class="card-body">
                <div id="editor-CookingStep" class="snow-editor" style="height: 300px;">
                    <!-- Content here... -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal footer -->
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Submit</button>
    </div>
</form>

        </div>
    </div>
</div>

                                     <div class="tab-pane fade show" id="Recipe" role="tabpanel" aria-labelledby="Recipe-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="mb-0">Recipe</h3>
                                            </div>
                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#recipeModal"></button>
                                                Add Recipe
                                                </button>
                                            <div class="card-body">
                                                <div class="table-responsive" id="table-recipe">
                                                    <!-- Dynamic content loaded via JS -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
<style>
    .multi-wrapper .search-input {
        margin-bottom: 16px !important;
        border-bottom: 1px solid #dee2e6;
        border-radius: 6px;
    }

    .multi-wrapper {
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
    }

    .search-input {
        border: 1px solid #ced4da !important;
        border-radius: 6px;
        padding: 8px 12px;
        background-color: #fff;
        outline: none;
        box-shadow: none;
    }

    .ql-toolbar.ql-snow {
        border-radius: 6px 6px 0 0;
    }

    .ql-container.ql-snow {
        border-radius: 0 0 6px 6px;
        min-height: 300px;
    }

    .modal-body {
        max-height: calc(100vh - 150px);
        overflow-y: auto;
        padding: 1.5rem;
    }

    .snow-editor {
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 10px;
        background-color: #fff;
    }
</style>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
        // MULTISELECT: Header
        const multiSelectHeader = document.getElementById("multiselect-header");
        if (multiSelectHeader) {
            multi(multiSelectHeader, {
                enable_search: true,
                non_selected_header: "Ingredient Tag",
                selected_header: "Selected"
            });
        }

        // MULTISELECT: Option Group (nếu dùng)
        const multiSelectOptGroup = document.getElementById("multiselect-optiongroup");
        if (multiSelectOptGroup) {
            multi(multiSelectOptGroup, {
                enable_search: true
            });
        }

        // AUTOCOMPLETE
        const autoCompleteCars = new autoComplete({
            selector: "#autoCompleteCars",
            placeHolder: "Search for Cars...",
            data: {
                src: [
                    "Chevrolet", "Fiat", "Ford", "Honda", "Hyundai", "Kia", "Mahindra", "Maruti",
                    "Mitsubishi", "MG", "Nissan", "Renault", "Skoda", "Tata", "Toyato", "Volkswagen"
                ],
                cache: true
            },
            resultsList: {
                element: function (list, data) {
                    if (!data.results.length) {
                        const resultDiv = document.createElement("div");
                        resultDiv.setAttribute("class", "no_result");
                        resultDiv.innerHTML = '<span>Found No Results for "' + data.query + '"</span>';
                        list.prepend(resultDiv);
                    }
                },
                noResults: true
            },
            resultItem: {
                highlight: true
            },
            events: {
                input: {
                    selection: function (event) {
                        const value = event.detail.selection.value;
                        autoCompleteCars.input.value = value;
                    }
                }
            }
        });

     
     
    });
</script>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        var quillIngredient = new Quill('#editor-Ingredient', {
            theme: 'snow'
        });

        var quillCookingStep = new Quill('#editor-CookingStep', {
            theme: 'snow'
        });
    });
</script>


                                    @* ///FEEDBACK *@
                                     @* <div class="tab-pane fade" id="Feedback" role="tabpanel" aria-labelledby="Feedback-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="mb-0">Your Feedback</h3>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive" id="table-feedback">
                                                </div>
                                            </div>
                                        </div>
                                    </div> *@
                                    <script>
                                        document.addEventListener("DOMContentLoaded", function () {
                                            const container = document.getElementById("table-recipe");
                                             var list = @Html.Raw(JsonSerializer.Serialize(Model.Reivew)); 


                                   
                                            function initializeGrid(data) {
                                                if (!container.dataset.gridInitialized) {
                                                    container.innerHTML = "";
                                                    gridInstance = new gridjs.Grid({
                                                        columns: [
                                                            { name: "ID", hidden: true },
                                                            { name: "Product Name" },
                                                            { name: "Comment" },
                                                            { name: "Comment Date" },
                                                            { name: "Rating" },
                                                            { name: "Reply" }
                                                        ],
                                                        pagination: {
                                                            enabled: true,
                                                            limit: 5,
                                                            summary: true
                                                        },
                                                        sort: true,
                                                        search: true,
                                                        data: data.map(u => [
                                                            u.ID,
                                                            u.ProductName,
                                                            u.Cmt,
                                                            new Date(u.Datecmt).toLocaleDateString(), // Sửa 'review.Datecmt' thành 'u.Datecmt'
                                                            u.Rating,
                                                            u.Relay // Thêm Reply vào dữ liệu
                                                        ])
                                                    }).render(container);

                                                    container.dataset.gridInitialized = "true"; // Đánh dấu đã khởi tạo grid
                                                }
                                            }

                                            initializeGrid(list); // Gọi hàm khởi tạo bảng với dữ liệu
                                        });
                                    </script>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
  
    
    <footer class="main">
        <section class="newsletter mb-15">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="position-relative newsletter-inner">
                            <div class="newsletter-content">
                                <h2 class="mb-20">
                                    Stay home & get your daily <br />
                                    needs from our shop
                                </h2>
                                <p class="mb-45">
                                    Start You'r Daily Shopping with <span class="text-brand">
                                        Nest
                                        Mart
                                    </span>
                                </p>
                                <form class="form-subcriber d-flex">
                                    <input type="email" placeholder="Your emaill address" />
                                    <button class="btn" type="submit">Subscribe</button>
                                </form>
                            </div>
                            <img src="~/assets/imgs/banner/banner-13.png" alt="newsletter" />
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="featured section-padding">
            <div class="container">
                <div class="row">
                    <div class="col-lg-1-5 col-md-4 col-12 col-sm-6 mb-md-4 mb-xl-0">
                        <div class="banner-left-icon d-flex align-items-center wow fadeIn animated">
                            <div class="banner-icon">
                                <img src="~/assets/imgs/theme/icons/icon-1.svg" alt="" />
                            </div>
                            <div class="banner-text">
                                <h3 class="icon-box-title">Best prices & offers</h3>
                                <p>Orders $50 or more</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-1-5 col-md-4 col-12 col-sm-6">
                        <div class="banner-left-icon d-flex align-items-center wow fadeIn animated">
                            <div class="banner-icon">
                                <img src="~/assets/imgs/theme/icons/icon-2.svg" alt="" />
                            </div>
                            <div class="banner-text">
                                <h3 class="icon-box-title">Free delivery</h3>
                                <p>24/7 amazing services</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-1-5 col-md-4 col-12 col-sm-6">
                        <div class="banner-left-icon d-flex align-items-center wow fadeIn animated">
                            <div class="banner-icon">
                                <img src="~/assets/imgs/theme/icons/icon-3.svg" alt="" />
                            </div>
                            <div class="banner-text">
                                <h3 class="icon-box-title">Great daily deal</h3>
                                <p>When you sign up</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-1-5 col-md-4 col-12 col-sm-6">
                        <div class="banner-left-icon d-flex align-items-center wow fadeIn animated">
                            <div class="banner-icon">
                                <img src="~/assets/imgs/theme/icons/icon-4.svg" alt="" />
                            </div>
                            <div class="banner-text">
                                <h3 class="icon-box-title">Wide assortment</h3>
                                <p>Mega Discounts</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-1-5 col-md-4 col-12 col-sm-6">
                        <div class="banner-left-icon d-flex align-items-center wow fadeIn animated">
                            <div class="banner-icon">
                                <img src="~/assets/imgs/theme/icons/icon-5.svg" alt="" />
                            </div>
                            <div class="banner-text">
                                <h3 class="icon-box-title">Easy returns</h3>
                                <p>Within 30 days</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-1-5 col-md-4 col-12 col-sm-6 d-xl-none">
                        <div class="banner-left-icon d-flex align-items-center wow fadeIn animated">
                            <div class="banner-icon">
                                <img src="~/assets/imgs/theme/icons/icon-6.svg" alt="" />
                            </div>
                            <div class="banner-text">
                                <h3 class="icon-box-title">Safe delivery</h3>
                                <p>Within 30 days</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section class="section-padding footer-mid">
            <div class="container pt-15 pb-20">
                <div class="row">
                    <div class="col">
                        <div class="widget-about font-md mb-md-3 mb-lg-3 mb-xl-0">
                            <div class="logo mb-30">
                                <a href="index.html" class="mb-15">
                                    <img src="~/assets/imgs/theme/logo.svg"
                                         alt="logo" />
                                </a>
                                <p class="font-lg text-heading">Awesome grocery store website template</p>
                            </div>
                            <ul class="contact-infor">
                                <li>
                                    <img src="~/assets/imgs/theme/icons/icon-location.svg" alt="" /><strong>
                                        Address:
                                    </strong> <span>5171 W Campbell Ave undefined Kent, Utah 53127 United States</span>
                                </li>
                                <li>
                                    <img src="~/assets/imgs/theme/icons/icon-contact.svg" alt="" /><strong>
                                        Call
                                        Us:
                                    </strong><span>(+91) - 540-025-124553</span>
                                </li>
                                <li>
                                    <img src="~/assets/imgs/theme/icons/icon-email-2.svg"
                                         alt="" /><strong>Email:</strong><span>sale@Nest.com</span>
                                </li>
                                <li>
                                    <img src="~/assets/imgs/theme/icons/icon-clock.svg"
                                         alt="" /><strong>Hours:</strong><span>10:00 - 18:00, Mon - Sat</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="footer-link-widget col">
                        <h4 class="widget-title">Company</h4>
                        <ul class="footer-list mb-sm-5 mb-md-0">
                            <li><a href="#">About Us</a></li>
                            <li><a href="#">Delivery Information</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Terms &amp; Conditions</a></li>
                            <li><a href="#">Contact Us</a></li>
                            <li><a href="#">Support Center</a></li>
                            <li><a href="#">Careers</a></li>
                        </ul>
                    </div>
                    <div class="footer-link-widget col">
                        <h4 class="widget-title">Account</h4>
                        <ul class="footer-list mb-sm-5 mb-md-0">
                            <li><a href="#">Sign In</a></li>
                            <li><a href="#">View Cart</a></li>
                            <li><a href="#">My Wishlist</a></li>
                            <li><a href="#">Track My Order</a></li>
                            <li><a href="#">Help Ticket</a></li>
                            <li><a href="#">Shipping Details</a></li>
                            <li><a href="#">Compare products</a></li>
                        </ul>
                    </div>
                    <div class="footer-link-widget col">
                        <h4 class="widget-title">Corporate</h4>
                        <ul class="footer-list mb-sm-5 mb-md-0">
                            <li><a href="#">Become a Vendor</a></li>
                            <li><a href="#">Affiliate Program</a></li>
                            <li><a href="#">Farm Business</a></li>
                            <li><a href="#">Farm Careers</a></li>
                            <li><a href="#">Our Suppliers</a></li>
                            <li><a href="#">Accessibility</a></li>
                            <li><a href="#">Promotions</a></li>
                        </ul>
                    </div>
                    <div class="footer-link-widget col">
                        <h4 class="widget-title">Popular</h4>
                        <ul class="footer-list mb-sm-5 mb-md-0">
                            <li><a href="#">Milk & Flavoured Milk</a></li>
                            <li><a href="#">Butter and Margarine</a></li>
                            <li><a href="#">Eggs Substitutes</a></li>
                            <li><a href="#">Marmalades</a></li>
                            <li><a href="#">Sour Cream and Dips</a></li>
                            <li><a href="#">Tea & Kombucha</a></li>
                            <li><a href="#">Cheese</a></li>
                        </ul>
                    </div>
                    <div class="footer-link-widget widget-install-app col">
                        <h4 class="widget-title">Install App</h4>
                        <p class="wow fadeIn animated">From App Store or Google Play</p>
                        <div class="download-app">
                            <a href="#" class="hover-up mb-sm-2 mb-lg-0">
                                <img class="active"
                                     src="~/assets/imgs/theme/app-store.jpg" alt="" />
                            </a>
                            <a href="#" class="hover-up mb-sm-2">
                                <img src="~/assets/imgs/theme/google-play.jpg"
                                     alt="" />
                            </a>
                        </div>
                        <p class="mb-20">Secured Payment Gateways</p>
                        <img class="wow fadeIn animated" src="~/assets/imgs/theme/payment-method.png" alt="" />
                    </div>
                </div>
            </div>
        </section>
        <div class="container pb-30">
            <div class="row align-items-center">
                <div class="col-12 mb-30">
                    <div class="footer-bottom"></div>
                </div>
                <div class="col-xl-4 col-lg-6 col-md-6">
                    <p class="font-sm mb-0">
                        &copy; 2024, <strong class="text-brand">Nest</strong> - HTML Ecommerce
                        Template <br />All rights reserved
                    </p>
                </div>
                <div class="col-xl-4 col-lg-6 text-center d-none d-xl-block">
                    <div class="hotline d-lg-inline-flex mr-30">
                        <img src="~/assets/imgs/theme/icons/phone-call.svg" alt="hotline" />
                        <p>1900 - 6666<span>Working 8:00 - 22:00</span></p>
                    </div>
                    <div class="hotline d-lg-inline-flex">
                        <img src="~/assets/imgs/theme/icons/phone-call.svg" alt="hotline" />
                        <p>1900 - 8888<span>24/7 Support Center</span></p>
                    </div>
                </div>
                <div class="col-xl-4 col-lg-6 col-md-6 text-end d-none d-md-block">
                    <div class="mobile-social-icon">
                        <h6>Follow Us</h6>
                        <a href="#"><img src="~/assets/imgs/theme/icons/icon-facebook-white.svg" alt="" /></a>
                        <a href="#"><img src="~/assets/imgs/theme/icons/icon-twitter-white.svg" alt="" /></a>
                        <a href="#"><img src="~/assets/imgs/theme/icons/icon-instagram-white.svg" alt="" /></a>
                        <a href="#"><img src="~/assets/imgs/theme/icons/icon-pinterest-white.svg" alt="" /></a>
                        <a href="#"><img src="~/assets/imgs/theme/icons/icon-youtube-white.svg" alt="" /></a>
                    </div>
                    <p class="font-sm">Up to 15% discount on your first subscribe</p>
                </div>
            </div>
        </div>
    </footer>
    <!-- Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="text-center">
                    <img src="~/assets/imgs/theme/loading.gif" alt="" />
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $("#updateProfileForm").submit(function (event) {
            event.preventDefault();

            var birthdayValue = $("#Birthday").val();
            var formData = {
                userView: {
                    FirstName: $("#FirstName").val(),
                    LastName: $("#LastName").val(),
                    UserName: $("#UserName").val(),
                    Email: $("#Email").val(),
                    PhoneNumber: $("#PhoneNumber").val(),
                    Address: $("#Address").val(),
                    Birthday: birthdayValue ? birthdayValue : null,  // Nếu trường Birthday rỗng, gửi null
                }
            };

          $.ajax({
    url: "/Users/UpdateProfile",
    type: "POST",
    contentType: "application/json",
    data: JSON.stringify(formData),
    beforeSend: function () {
        Swal.fire({
            title: "Updating...",
            text: "Please wait...",
            icon: "info",
            showConfirmButton: false,
            allowOutsideClick: false
        });
    },
    success: function (response) {
        if (response.success) {
            Swal.fire({
                title: "Success!",
                text: "Profile updated successfully!",
                icon: "success",
                confirmButtonText: "OK"
            }).then(() => {
                $("#account-detail").load(location.href + " #account-detail > *");
            });
        } else {
            Swal.fire("Error!", response.message || "Profile update failed!", "error");
        }
    },
    error: function (xhr) {
        let errorMessage = "Cannot connect to the server.";
        if (xhr.responseJSON && xhr.responseJSON.message) {
            errorMessage = xhr.responseJSON.message;
        }
        Swal.fire("Error!", errorMessage, "error");
    }
});

        });
    });
</script>

    <script>
        $(document).ready(function () {
            $("#btnRegisterSeller").click(function (e) {
                e.preventDefault(); // Ngăn reload trang

                $.ajax({
                    url: "/Users/RegisterSeller", // Endpoint xử lý
                    type: "POST",
                    contentType: "application/json",
                    success: function (response) {
                        if (response.success) {
                            Swal.fire({
                                icon: "success",
                                title: "Success",
                                text: "Your seller registration request has been sent successfully!",
                                confirmButtonText: "OK"
                            }).then(() => {
                                // Cập nhật #address khi đăng ký thành công
                                $("#address").load(location.href + " #address > *");
                            });
                        } else {
                            Swal.fire({
                                icon: "error",
                                title: "Error",
                                text: response.message,
                                confirmButtonText: "OK"
                            }).then(() => {
                                // Nếu lỗi do thiếu thông tin => Cập nhật lại #account-detail
                                if (response.message.includes("Please update all required information")) {
                                    $('#account-detail-tab').tab('show'); // Nếu bạn dùng Bootstrap tabs
                                }
                            });
                        }
                    },
                    error: function () {
                        Swal.fire({
                            icon: "error",
                            title: "Error",
                            text: "An error occurred! Please try again.",
                            confirmButtonText: "OK"
                        });
                    }
                });
            });
        });



    </script>

    
                            <script>
                                document.addEventListener("DOMContentLoaded", function () {
                                    var hash = window.location.hash;
                                    if (hash) {
                                        var triggerEl = document.querySelector(`a[href="${hash}"]`);
                                        if (triggerEl) {
                                            var tab = new bootstrap.Tab(triggerEl);
                                            tab.show();
                                        }
                                    }
                                });
                            </script>

<!-- Bootstrap 5 CSS & JS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Quill -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/multi.js@0.5.0/multi.min.css">
<script src="https://cdn.jsdelivr.net/npm/multi.js@0.5.0/multi.min.js"></script>
    <!-- Vendor JS-->
    <script src="~/assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="~/assets/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="~/assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
    <script src="~/assets/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="~/assets/js/plugins/slick.js"></script>
    <script src="~/assets/js/plugins/jquery.syotimer.min.js"></script>
    <script src="~/assets/js/plugins/wow.js"></script>
    <script src="~/assets/js/plugins/perfect-scrollbar.js"></script>
    <script src="~/assets/js/plugins/magnific-popup.js"></script>
    <script src="~/assets/js/plugins/select2.min.js"></script>
    <script src="~/assets/js/plugins/waypoints.js"></script>
    <script src="~/assets/js/plugins/counterup.js"></script>
    <script src="~/assets/js/plugins/jquery.countdown.min.js"></script>
    <script src="~/assets/js/plugins/images-loaded.js"></script>
    <script src="~/assets/js/plugins/isotope.js"></script>
    <script src="~/assets/js/plugins/scrollup.js"></script>
    <script src="~/assets/js/plugins/jquery.vticker-min.js"></script>
    <script src="~/assets/js/plugins/jquery.theia.sticky.js"></script>
    <script src="~/assets/js/plugins/jquery.elevatezoom.js"></script>
    <!-- Template  JS -->
    <script src="~/assets/js/main.js?v=6.0"></script>
    <script src="~/assets/js/shop.js?v=6.0"></script>
        <script src="~/assets/js/gridjs/gridjs.umd.js"></script>
</body>

</html>
@* <script>
    document.addEventListener("DOMContentLoaded", function () {
        const container = document.getElementById("Exampletable");
        var list = @Html.Raw(JsonSerializer.Serialize(Model.Balance));

        container.innerHTML = "";

        new gridjs.Grid({
            columns: [
                { name: "NO.", width: "90px" , formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                { name: "Before", width: "110px", formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                {
                    name: "Before",
                    width: "110px",
                    formatter: (e) => {
                        const color = e < 0 ? "red" : "green";
                        return gridjs.html(`<p style="color:${color}">${e}</p>`)
                    }
                },
                { name: "After", width: "110px", formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                { name: "Type", width: "100px", formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                {
                    name: "Status",
                    width: "130px",
                    formatter: (e) => {
                        let color = "#C3A73A";

                        if (e.toLowerCase() === "done") {
                            color = "green";
                        } else if (e.toLowerCase() === "cancel") {
                            color = "#C10103";
                        }

                        return gridjs.html(`<p style="color:${color}; font-weight:bold;">${e}</p>`);
                    }
                },

                {
                    name: "Type",
                    width: "100px",
                    formatter: (e) => {
                        const date = new Date(e);
                        const formatted = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}:${date.getSeconds().toString().padStart(2, '0')}`;
                        return gridjs.html(`<p>${formatted}</p>`);
                    }
                },
                {
                    name: "Invoice",
                    width: "150px",
                    formatter: (e) => gridjs.html(`<a href="${e}" target="_blank" class="text-reset text-decoration-underline">Details</a>`)

                }
            ],
            pagination: {
                enabled: true,
                limit: 5,
                summary: true
            },
            pageSize: [5, 10, 20, 50],
            sort: true,
            search: true,
            data: list.map(u => [
                u.No,
                u.Before,
                u.Change,
                u.After,
                u.Types,
                u.Status,
                u.Date,
                u.Invoice
            ])
        }).render(document.getElementById("Exampletable"));
    });

</script>
 *@

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const container = document.getElementById("Exampletable");
        var list = @Html.Raw(JsonSerializer.Serialize(Model.Balance));
        let gridInstance = null;
        let isInteracting = false; // Biến để theo dõi trạng thái tương tác

        // Hàm khởi tạo bảng
        function initializeGrid(data) {
            if (!container.dataset.gridInitialized) {
                container.innerHTML = "";
                gridInstance = new gridjs.Grid({
                    columns: [
                        { name: "NO.", width: "90px", formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                        { name: "Before", width: "110px", formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                        {
                            name: "Change", // Đổi tên để tránh trùng "Before"
                            width: "110px",
                            formatter: (e) => {
                                const color = e < 0 ? "red" : "green";
                                return gridjs.html(`<p style="color:${color}">${e}</p>`);
                            }
                        },
                        { name: "After", width: "110px", formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                        { name: "Type", width: "110px", formatter: (e) => gridjs.html(`<p>${e}</p>`) },
                        {
                            name: "Status",
                            width: "130px",
                            formatter: (e) => {
                                let color = "#C3A73A";
                                const status = e ? e.toLowerCase() : ""; 

                                if (status === "paid" || status === "success") {
                                    color = "green";
                                } else if (status === "cancelled") {
                                    color = "#C10103";
                                }

                                return gridjs.html(`<p style="color:${color}; font-weight:bold;">${e || "N/A"}</p>`);
                            }

                        },
                        {
                            name: "Date", // Đổi tên để tránh trùng "Type"
                            width: "100px",
                            formatter: (e) => {
                                const date = new Date(e);
                                const formatted = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}:${date.getSeconds().toString().padStart(2, '0')}`;
                                return gridjs.html(`<p>${formatted}</p>`);
                            }
                        },
                        {
                            name: "Invoice",
                            width: "150px",
                            formatter: (e) => gridjs.html(`<button type="button" class="btn btn-sm btn-light" onclick="window.open('${e}', '_blank')">Details</button>`)
                        }
                    ],
                    pagination: {
                        enabled: true,
                        limit: 5,
                        summary: true
                    },
                    pageSize: [5, 10, 20, 50],
                    sort: true,
                    search: true,
                    data: data.map(u => [
                        u.No,
                        u.Before,
                        u.Change,
                        u.After,
                        u.Types,
                        u.Status,
                        u.Date,
                        u.Invoice
                    ])
                }).render(container);

                container.dataset.gridInitialized = "true";
 
                container.addEventListener("click", () => isInteracting = true); 
                container.addEventListener("input", () => isInteracting = true); 
                const paginationButtons = container.querySelectorAll(".gridjs-pagination .gridjs-pages button");
                paginationButtons.forEach(button => {
                    button.addEventListener("click", () => {
                        isInteracting = true;
                        console.log("Pagination button clicked, stopping updates"); 
                    });
                });

            
                const sortButtons = container.querySelectorAll(".gridjs-sort");
                sortButtons.forEach(button => {
                    button.addEventListener("click", () => {
                        isInteracting = true;
                        console.log("Sort button clicked, stopping updates"); 
                    });
                });



                container.addEventListener("mouseleave", () => isInteracting = false);
                container.addEventListener("blur", () => isInteracting = false, true); 

            }
        }

        // Khởi tạo bảng lần đầu
        initializeGrid(list);

        // Hàm lấy dữ liệu mới qua AJAX
        function fetchUpdatedData() {
            if (!isInteracting) { // Chỉ cập nhật khi không tương tác
                fetch('/Users/UpdateBalance', { // Thay bằng URL endpoint thực tế
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => response.json())
                    .then(newData => {
                        if (gridInstance) {
                            gridInstance.updateConfig({
                                data: newData.map(u => [
                                    u.no,
                                    u.before,
                                    u.change,
                                    u.after,
                                    u.types,
                                    u.status,
                                    u.date,
                                    u.invoice
                                ])
                            }).forceRender(); // Cập nhật dữ liệu mà không reload toàn bộ
                        }
                    })
                    .catch(error => console.error('Error fetching data:', error));
            }
        }

        // Cập nhật dữ liệu mỗi 5 giây
        setInterval(fetchUpdatedData, 500000);

        // Gọi lần đầu tiên ngay lập tức (tuỳ chọn)
        fetchUpdatedData();
    });
</script>

  <script type="text/javascript">
    $("#btnDeposit").on("click", function () {

        $('#btnDeposit').html('<i class="fa fa-spinner fa-spin"></i> Đang xử lý...')
            .prop('disabled', true);
        var checkbox = parseInt($("#numOrder").val(), 10);
        var token = $("input[name='__RequestVerificationToken']").val();

        if (isNaN(checkbox) || checkbox <= 0) {
            setTimeout(() => {
                new Notify({
                    status: 'error',
                    title: 'Thất Bại',
                    text: 'Số tiền nạp tối thiểu là 100,000 Vnd',
                    effect: 'fade',
                    speed: 300,
                    showIcon: true,
                    showCloseButton: true,
                    autoclose: true,
                    autotimeout: 3000,
                    position: 'right top'
                });

                $('#btnDeposit').html('Add Payment').prop('disabled', false);
            }, 100); 
            return;
        }

        $('#btnDeposit').html('<i class="fa fa-spinner fa-spin"></i> Đang xử lý...')
            .prop('disabled', true);

        $.ajax({
            url: "@Url.Action("AddBalance", "Users")",
            method: "POST",
            dataType: "JSON",
            data: {
                number: $("#numOrder").val(),
                __RequestVerificationToken: token
            },
            success: function (response) {
                if (response.success) {
                    Swal.fire({
                        title: 'Thành công!',
                        text: 'Bạn sẽ được chuyển hướng đến trang thanh toán...',
                        icon: 'success',
                        confirmButtonText: 'OK'
                    }).then((result) => {
                        if (result.isConfirmed || result.isDismissed) {
                            window.location.href = response.msg;
                        }
                    });

                } else {
                    new Notify({
                        status: 'error',
                        title: 'Thất Bại',
                        text: response.msg || 'Gửi thất bại!',
                        effect: 'fade',
                        speed: 300,
                        showIcon: true,
                        showCloseButton: true,
                        autoclose: true,
                        autotimeout: 3000,
                        position: 'right top'
                    });
                }
                $('#btnDeposit').html('Add Payment').prop('disabled', false);
            },
            error: function () {
                new Notify({
                    status: 'error',
                    title: 'Thất Bại',
                    text: response.msg || 'Gửi thất bại!',
                    effect: 'fade',
                    speed: 300,
                    showIcon: true,
                    showCloseButton: true,
                    autoclose: true,
                    autotimeout: 3000,
                    position: 'right top'
                });
                $('#btnDeposit').html('Add Payment').prop('disabled', false);
            }
        });
    });
</script>

<script type="text/javascript">
    $("#btnWithdraw").on("click", function () {
        $('#btnWithdraw').html('<i class="fa fa-spinner fa-spin"></i> Đang xử lý...')
            .prop('disabled', true);
        var checkbox = parseInt($("#numOrderVut").val(), 10);
        var token = $("input[name='__RequestVerificationToken']").val();

        if (isNaN(checkbox) || checkbox < 500000) {
            setTimeout(() => {
            new Notify({
                status: 'error',
                title: 'Thất Bại',
                text: 'Số tiền rút tối thiểu là 500,000 Vnd',
                effect: 'fade',
                speed: 300,
                showIcon: true,
                showCloseButton: true,
                autoclose: true,
                autotimeout: 3000,
                position: 'right top'
            });
            $('#btnWithdraw').html('Withdraw').prop('disabled', false);
        }, 100);
    return;

        }

        $('#btnWithdraw').html('<i class="fa fa-spinner fa-spin"></i> Đang xử lý...')
            .prop('disabled', true);

        $.ajax({
            url: "@Url.Action("Withdraw", "Users")",
            method: "POST",
            dataType: "JSON",
            data: {
                number: $("#numOrderVut").val(),
                nameAcc: $("#nameAcc").val(),
                numAccount: $("#umaccou").val(),
                code: $("#code").val(),
                __RequestVerificationToken: token
            },
            success: function (response) {
                if (response.success) {
                    new Notify({
                        status: 'success',
                        title: 'Thành công!',
                        text: response.msg || 'Gửi thành công!',
                        effect: 'fade',
                        speed: 300,
                        showIcon: true,
                        showCloseButton: true,
                        autoclose: true,
                        autotimeout: 3000,
                        position: 'right top'
                    });

                } else {
                    new Notify({
                        status: 'error',
                        title: 'Thất Bại',
                        text: response.msg || 'Gửi thất bại!',
                        effect: 'fade',
                        speed: 300,
                        showIcon: true,
                        showCloseButton: true,
                        autoclose: true,
                        autotimeout: 3000,
                        position: 'right top'
                    });
                }
                $('#btnWithdraw').html('Withdraw').prop('disabled', false);
            },
            error: function () {
                Swal.fire(
                    'Thất bại',
                    "Đã xảy ra lỗi",
                    'error'
                );
                $('#btnWithdraw').html('Withdraw').prop('disabled', false);
            }
        });
    });
</script>